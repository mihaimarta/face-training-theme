(this["webpackJsonpface-training-theme"]=this["webpackJsonpface-training-theme"]||[]).push([[0],{518:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(32),o=n.n(i),c=n(11),s=(n(509),n(612)),l=n(58),u=n(26),d=n(50),j=n(8),m=n(85),b=n.n(m),h=n(9),v=n(46),p=n(4),f=n(594),O=n(15),x=n(528),g=n(29),y=n(213),C=n.n(y),I=n(24),T=n(21),S=n(365),w=n.n(S),P=Object({NODE_ENV:"production",PUBLIC_URL:"https://vidispine.github.io/face-training-theme",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!1,REACT_APP_TITLE:"Face Training Theme",REACT_APP_DOCUMENT_TITLE:"Face Training Theme"}).REACT_APP_VIDISPINE_URL,k=Object({NODE_ENV:"production",PUBLIC_URL:"https://vidispine.github.io/face-training-theme",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!1,REACT_APP_TITLE:"Face Training Theme",REACT_APP_DOCUMENT_TITLE:"Face Training Theme"}).REACT_APP_APP_TITLE,D="^^PREFIX^^",R="^^SUFFIX^^",E="vcs_face_isTrainingMaterial",A="vcs_face_value",L="vcs_face_method",_="vcs_face_externalId",N="adu_face_DeepVAKeyframeAnalyzer",F="adu_av_valueId",M="adu_av_value",U="adu_av_confidence",V=n(1);function q(e){var t=e.subheader,n=e.IconComponent,a=void 0===n?w.a:n,r=Object(s.a)().t;return Object(V.jsxs)(T.a,{container:!0,alignItems:"center",children:[Object(V.jsx)(u.a,{pr:2,children:Object(V.jsx)(a,{color:"inherit"})}),Object(V.jsxs)(u.a,{children:[Object(V.jsx)(I.a,{variant:"h6",color:"inherit",children:k||r("appTitle")}),t&&Object(V.jsx)(I.a,{variant:"subtitle2",color:"inherit",children:t})]})]})}var B=n(264),W=n(174),z=n(378),G=n(369);B.a.use(G.a).use(z.a).use(W.e).init({debug:!1,fallbackLng:"en",whitelist:["en","sv","de"],supportedLngs:["en","sv","de"],interpolation:{escapeValue:!1},backend:{loadPath:"".concat("https://vidispine.github.io/face-training-theme","/locales/{{lng}}/{{ns}}.json")}});var H=B.a,J=n(12),K=n(5),Q=n(33),X=n(77),Y=n(53),$=n(49),Z=n(231),ee=n(156),te=n(65),ne=n(530),ae=n(595),re=n(31),ie=n(47),oe=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"face";return K.j.createJob({queryParams:{type:"VCS_TRAINING_MERGE_ITEMS",jobmetadata:[{key:"itemId",value:e},{key:"targetItemId",value:t},{key:"modelType",value:n}]}})},ce=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"face";return new Promise((function(a,r){return K.j.createJob({queryParams:{type:"VCS_TRAINING_RELABEL_ITEM",jobmetadata:[{key:"itemId",value:e},{key:"newLabel",value:t},{key:"modelType",value:n}]}}).then((function(n){var i=Object(re.a)(Object(l.a)({},A,t));return K.i.updateItemMetadata({itemId:e,metadataDocument:i}).then((function(){return a(n)})).catch(r)})).catch(r)}))},se=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a="item",r=window.localStorage.getItem("TRAINING_COLLECTION_ID"),i=n;i||(i=[]);var o=t;return o||(o=[]),Array.isArray(i)||(i=i.split(", ")),Array.isArray(o)||(o=o.split(", ")),i.includes(r)||o.push(r),o.length?new Promise((function(t,n){var c=o.map((function(t){return!i.includes(t)&&Object(j.m)(Object(h.a)({entityId:e,entityType:a,collectionId:t},r!==t&&{rootParentId:r}))})),s=i.map((function(t){return!o.includes(t)&&Object(j.o)({entityId:e,entityType:a,collectionId:t,rootParentId:r})}));Promise.all([].concat(Object(ie.a)(c),Object(ie.a)(s))).then(t).catch(n)})):Promise.resolve()};var le=n(45),ue=function(e){var t=e.open,n=e.onClose,a=e.onSuccess,r=e.title,i=void 0===r?"Dialog":r,o=e.okText,c=void 0===o?"Ok":o,s=e.noText,l=void 0===s?"Cancel":s,u=e.message,d=void 0===u?"Message":u,j=e.Dialog,m=void 0===j?X.a:j;return Object(V.jsxs)(m,{open:t,onClose:n,children:[Object(V.jsx)(Y.a,{children:i}),Object(V.jsx)($.a,{dividers:!0,children:d}),Object(V.jsxs)(te.a,{children:[Object(V.jsx)(O.a,{onClick:n,children:l}),Object(V.jsx)(O.a,{variant:"contained",color:"primary",onClick:a,children:c})]})]})},de=function(e){var t=e.Dialog,n=void 0===t?ue:t,a=Object(le.a)(e,["Dialog"]);return Object(V.jsx)(n,Object(h.a)({},a))},je=r.a.createContext({}),me=function(e){var t=e.children,n=r.a.useState(!1),a=Object(J.a)(n,2),i=a[0],o=a[1],c=r.a.useState({}),s=Object(J.a)(c,2),l=s[0],u=l.config,d=l.resolve,j=l.reject,m=s[1],b=function(){m({}),o(!1)};return Object(V.jsxs)(je.Provider,{value:{openDialog:function(e){o(!0),m(e)}},children:[Object(V.jsx)(de,Object(h.a)(Object(h.a)({},u),{},{open:i,onSuccess:function(e){d(e),b()},onClose:function(e){j(e),b()}})),t]})},be=function(){var e=r.a.useContext(je).openDialog;return{showDialog:function(t){return new Promise((function(n,a){return e({config:t,resolve:n,reject:a})}))}}},he=r.a.createContext({resourceType:void 0,resourceListDocument:void 0}),ve=function(e){var t=e.children,n=e.resourceType,a=r.a.useState(),i=Object(J.a)(a,2),o=i[0],c=i[1];return r.a.useEffect((function(){K.o.listResourceType({resourceType:n}).then((function(e){var t=e.data;return c(t)}))}),[n]),Object(V.jsx)(he.Provider,{value:{resourceListDocument:o,resourceType:n},children:t})};function pe(){var e=r.a.useContext(he);if(void 0===e)throw new Error("getCognitiveResources must be used within a ResourceProvider");var t=e.resourceListDocument,n=(t=void 0===t?{}:t).resource;return{resource:(void 0===n?[]:n).filter((function(e){var t=e.vidinet,n=(t=void 0===t?{}:t).state,a=t.type;return"ONLINE"===n&&"COGNITIVE_SERVICE"===a}))}}var fe=n(542),Oe=n(232),xe=function(e){var t=e.open,n=e.message,a=e.severity,r=e.hideNotification;return Object(V.jsx)(fe.a,{open:t,autoHideDuration:2e3,onClose:r,children:Object(V.jsx)(Oe.a,{elevation:6,variant:"filled",severity:a,onClose:r,children:n})})},ge=Object(a.createContext)();function ye(e){var t=e.children,n=Object(a.useState)({open:!1,message:"",severity:""}),r=Object(J.a)(n,2),i=r[0],o=r[1],c=function(e,t){"clickaway"!==t&&o({open:!1,message:i.message,severity:i.severity})};return Object(V.jsxs)(ge.Provider,{value:{setNotification:o,hideNotification:c},children:[t,Object(V.jsx)(xe,{open:i.open,message:i.message,severity:i.severity,hideNotification:c})]})}function Ce(){var e=r.a.useContext(ge);if(void 0===e)throw new Error("useSnackbar must be used within a SnackbarProvider");return e}var Ie=r.a.createContext(),Te=function(e){var t=e.children,n=e.uploadProps,a=Object(j.D)(n),r=a.onAddFiles,i=a.onChangeMetadata,o=a.onUpload,c=a.onRemoveFiles,s=a.onRemoveFile,l=a.files,u=function(e){return new Promise((function(t){r(e),t()})).then((function(){document.querySelector(".MuiListItem-root").click()}))};return Object(V.jsx)(Ie.Provider,{value:{useUploadFiles:function(){return{onAddFiles:u,onChangeMetadata:i,onUpload:o,onRemoveFiles:c,onRemoveFile:s,files:l}}},children:t})},Se=r.a.createContext({}),we=function(e){var t=e.children,n=Object(j.q)(K.d.searchCollection),a=n.request,i=n.data,o=void 0===i?{}:i,c=n.isLoading,s=n.isError;r.a.useEffect((function(){a({itemSearchDocument:{operator:{field:[{name:"vcs_face_isTrainingCollection",value:[{value:!0}]}],operation:"OR"}}})}),[a]);var l=r.a.useMemo((function(){if(c||s)return null;var e=o.collection,t=o.hits;if(!(void 0===t?0:t))return null;var n=Object(J.a)(e,1)[0].id;return window.localStorage.setItem("TRAINING_COLLECTION_ID",n),n}),[c,s,o]),u=Object(j.q)(K.o.listResourceType),d=u.request,m=u.data,b=u.isLoading,h=u.isError;r.a.useEffect((function(){d({resourceType:"callback"})}),[d]);var v=r.a.useMemo((function(){if(b||h)return null;var e=m.resource,t=void 0===e?[{}]:e,n=Object(J.a)(t,1)[0].id;return window.localStorage.setItem("CALLBACK_ID",n),n}),[b,h,m]),p=Object(j.q)(K.p.searchItemCollection),f=p.request,O=p.isLoading,x=p.isError;r.a.useEffect((function(){var e=[A,L,_],t=[E,"vcs_face_isTrainingCollection","vcs_face_isSampleCollection"],n={filter:[].concat(Object(ie.a)(e.map((function(e){return{operation:"OR",field:[{name:e,value:[{value:"*"}]}]}}))),Object(ie.a)(t.map((function(e){return{operation:"OR",field:[{name:e,value:[{value:!0}]}]}}))))};f({queryParams:{number:1},itemSearchDocument:n})}),[f]);var g=x||s||h,y=O||c||b,C=!y&&!g;return Object(V.jsx)(Se.Provider,{value:{trainingId:l,callbackId:v,isConfigured:C,isLoading:y,isError:g},children:t})},Pe=function(){var e=r.a.useContext(Se);if(void 0===e)throw new Error("useDialogContext must be used within a DialogProvider");return e},ke=function(e){var t=e.collectionDocument,n=e.setCollectionDocument,a=r.a.useMemo((function(){return Object(re.f)(t.metadata,{flat:!0})}),[t]).title,i=void 0===a?"":a,o=r.a.useCallback((function(e){var t=e.target;return t.value?n({name:t.value,metadata:Object(re.a)({title:t.value,vcs_face_isSampleCollection:!0})}):n({})}),[n]);return Object(V.jsx)(Q.a,{value:i,required:!0,autoFocus:!0,margin:"dense",label:"New collection",type:"text",fullWidth:!0,onChange:o})},De=function(e){var t=e.open,n=e.onClose,a=e.item,i=void 0===a?{}:a,o=e.onSuccess,s=e.onError,l=void 0===s?function(){return null}:s,u=e.view,d=Pe().trainingId,m=i.itemId,b=i.parentId,h=r.a.useState(u||"search"),v=Object(J.a)(h,2),p=v[0],f=v[1],x=r.a.useState({}),g=Object(J.a)(x,2),y=g[0],C=g[1],I=r.a.useState([]),T=Object(J.a)(I,2),S=T[0],w=T[1],P=Object(j.A)({queryParams:{field:["collectionId","title"],content:"metadata"},rowsPerPage:5,itemSearchDocument:{filter:[{name:"collectionId",operation:"NOT",field:[{name:"collectionId",value:[{value:d}]}]}]}}),k=r.a.useMemo((function(){return"search"===p?S.length<1:"create"===p&&Object.keys(y).length<1}),[p,S,y]);return Object(V.jsxs)(X.a,{open:t,onClose:n,children:[Object(V.jsx)(Y.a,{children:"Add to collection"}),Object(V.jsxs)($.a,{dividers:!0,children:[Object(V.jsxs)(Z.a,{value:p,onChange:function(e,t){return t&&f(t)},variant:"fullWidth",textColor:"primary",indicatorColor:"primary",style:{marginBottom:"10px"},children:[Object(V.jsx)(ee.a,{disabled:void 0!==u,value:"search",label:"Search",icon:Object(V.jsx)(ne.a,{})}),Object(V.jsx)(ee.a,{disabled:void 0!==u,value:"create",label:"Create",icon:Object(V.jsx)(ae.a,{})})]}),{search:Object(V.jsx)(c.d,{onChange:w,CollectionTableProps:{selected:S,onRowClick:function(e){var t=e.id;return w([t])}},searchProps:P}),create:Object(V.jsx)(ke,{collectionDocument:y,setCollectionDocument:C})}[p]]}),Object(V.jsx)(te.a,{children:Object(V.jsx)(O.a,{onClick:function(){var e=Object(J.a)(S,1)[0];"create"===p&&function(e){return K.d.createCollection({collectionDocument:e})}(y).then((function(e){var t=e.data.id;return se(m,t,b).then(o).catch(l)})).catch(l),"search"===p&&se(m,e,b).then(o).catch(l).finally(n)},color:"primary",variant:"contained",disabled:k,children:"Add"})})]})},Re=function(e){var t=e.open,n=e.onClose,a=e.onSuccess,r=e.onError,i=e.itemId;return Object(V.jsxs)(X.a,{fullWidth:!0,open:t,onClose:n,children:[Object(V.jsx)(Y.a,{children:"Add new resource"}),Object(V.jsx)($.a,{dividers:!0,children:Object(V.jsx)(c.N,{uploadProps:{onUploadFile:function(e){var t=e.file;return K.q.createShapeImportRaw({itemId:i,file:t,queryParams:{tag:[E]}}).then(a).catch(r)}},allowUploadToCollection:!1,UploadListItemProps:{onClick:function(){return null}}})})]})},Ee=n(104),Ae=n.n(Ee),Le=n(370),_e=n.n(Le),Ne=(n(516),n(136)),Fe=n(596),Me=n(597),Ue={options:[{label:"ID",value:"itemId"},{label:"Name",value:A},{label:"Type",value:"type"}]},Ve=function(e){var t=e.filename,n=e.setFilename,a=e.collectionId,r=e.setCollectionId,i=Pe().trainingId,o=Object(j.A)({queryParams:{field:["collectionId","title"],content:"metadata"},rowsPerPage:5,itemSearchDocument:{filter:[{name:"collectionId",operation:"NOT",field:[{name:"collectionId",value:[{value:i}]}]}]}});return Object(V.jsxs)(V.Fragment,{children:[Object(V.jsx)(I.a,{variant:"h6",children:"Who is this?"}),Object(V.jsx)(c.L,{autoFocus:!0,label:"Name of person",input:{onChange:function(e){var t=e.target;return n(t.value)},value:t}}),Object(V.jsxs)(u.a,{mt:1,children:[Object(V.jsx)(I.a,{paragraph:!0,variant:"subtitle2",children:"* Adding this resource to a collection is optional"}),Object(V.jsx)(c.d,{CollectionTableProps:{onRowClick:function(e){var t=e.id;return r(a.includes(t)?[]:[t])},selected:a},searchProps:o,searchPlaceholder:"Search collections..."})]})]})},qe=function(e){var t=e.itemId,n=e.params,a=void 0===n?{view:"search",selected:[],filename:"",collectionId:[]}:n,i=e.setParams,o=void 0===i?function(){return null}:i,s=e.allowCreate,l=void 0!==s&&s,u=r.a.useState({itemSearchDocument:{filter:[{name:"training_material",operation:"AND",field:[{name:E,value:[{value:!0}]}]},{name:"itemId",operation:"NOT",field:[{name:"itemId",value:[{value:t}]}]}]},queryParams:{field:[A,"itemId"],content:"metadata"},rowsPerPage:5}),d=Object(J.a)(u,1)[0];return Object(V.jsxs)(V.Fragment,{children:[Object(V.jsxs)(Z.a,{value:a.view,onChange:function(e,t){return t&&(n=t,o(Object(h.a)(Object(h.a)({},a),{},{view:n})));var n},variant:"fullWidth",textColor:"primary",indicatorColor:"primary",style:{marginBottom:"10px"},children:[Object(V.jsx)(ee.a,{value:"search",label:"Search for face",icon:Object(V.jsx)(ne.a,{})}),Object(V.jsx)(ee.a,{disabled:!l,value:"create",label:"Create new face",icon:Object(V.jsx)(Fe.a,{})})]}),{search:Object(V.jsx)(c.p,{ItemTableProps:Object(h.a)({onRowClick:function(e){var t=e.id,n=e.metadata,r=[];if(!a.selected.some((function(e){return e.id===t}))){var i=Object(re.f)(n,{flat:!0,arrayOnSingle:!1})[A];r.push({title:i,id:t})}o(Object(h.a)(Object(h.a)({},a),{},{selected:r}))},selected:a.selected.map((function(e){return e.id}))},Ue),searchProps:Object(j.A)(d),searchPlaceholder:"Search faces..."}),create:Object(V.jsx)(Ve,{filename:a.filename,setFilename:function(e){return o(Object(h.a)(Object(h.a)({},a),{},{filename:e}))},collectionId:a.collectionId,setCollectionId:function(e){return o(Object(h.a)(Object(h.a)({},a),{},{collectionId:e}))}})}[a.view]]})},Be=Object(p.a)((function(e){return{root:{backgroundColor:e.palette.background.default}}}))(c.B),We=function(e){var t=e.itemType,n=void 0===t?{}:t;return Object(V.jsx)(Be,{innerProps:{itemType:n}})},ze=function(e){var t=e.open,n=e.onClose,a=e.item,i=e.onSuccess,o=e.onError,c=void 0===o?function(){return null}:o,s=e.allowCreate,l=void 0!==s&&s,d=a.itemId,m=a.title,b=a.parentId,h=r.a.useState({view:"search",selected:[],filename:"",collectionId:[]}),v=Object(J.a)(h,2),p=v[0],f=v[1],x=p.view,g=p.selected,y=p.filename,C=p.collectionId,T=r.a.useMemo((function(){return"search"===x?g.length<1:"create"!==x||y.length<1}),[x,g,y]),S=r.a.useMemo((function(){var e=Object(J.a)(p.selected,1)[0],t=void 0===e?{}:e,n=t.title,a=t.id;return"".concat(n," (").concat(a,")")}),[p.selected]);return Object(V.jsxs)(X.a,{open:t,fullWidth:!0,maxWidth:"sm",onClose:n,children:[Object(V.jsxs)(Y.a,{children:["Map resource (",m,")"]}),Object(V.jsxs)($.a,{dividers:!0,children:[Object(V.jsx)(j.e,{itemId:d,queryParams:{content:["thumbnail"],"noauth-url":!0},children:Object(V.jsx)(We,{})}),Object(V.jsx)(qe,{itemId:d,params:p,setParams:f,allowCreate:l})]}),Object(V.jsxs)(te.a,{children:[Object(V.jsx)(u.a,{display:"flex",alignItems:"center",justifyContent:"space-between",width:1,children:Object(V.jsx)(u.a,{px:2,flexGrow:1,display:"flex",alignItems:"center",children:"search"===x&&p.selected.length>0&&Object(V.jsxs)(V.Fragment,{children:[Object(V.jsx)(Me.a,{style:{marginRight:8}}),Object(V.jsxs)(I.a,{variant:"body2",children:["This action will move the contents and references of\xa0",Object(V.jsx)(I.a,{variant:"button",children:"".concat(m," (").concat(d,")")}),"\xa0to\xa0",Object(V.jsx)(I.a,{variant:"button",children:S})]})]})})}),Object(V.jsx)(O.a,{style:{flexShrink:0},onClick:function(){if("search"===x){var e=Object(J.a)(p.selected,1)[0].id;if(!e)return;oe(d,e).then(i).catch(c)}if("create"===x){var t=Object(J.a)(C,1)[0];se(d,t,b).then((function(){return ce(d,y).then(i).catch(c)})).catch(c)}},color:"primary",variant:"contained",disabled:T,children:"create"===x?"Create item":"Map resource"})]})]})},Ge=n(382);function He(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(function(e){return(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)}))}var Je=["__mp3_160k"],Ke=["__mp4"],Qe=["__png"],Xe=["application/mxf"],Ye=[],$e=[],Ze=function(e){if(!e||!e.type)return[];var t=e.type.toLowerCase();return t.startsWith("audio")||$e.includes(t)?Je:t.startsWith("video")||Xe.includes(t)?Ke:t.startsWith("image")||Ye.includes(t)?Qe:[]},et=function(e){var t=e.file,n=e.collectionId,a=e.onProgress,r=e.metadata,i=void 0===r?{}:r,o=e.placeholderParams,c=void 0===o?{}:o,s=e.importParams,u=void 0===s?{}:s,d=e.chunkedUploadProps,j=void 0===d?{}:d,m=e.generateTransferId,b=void 0===m?He:m,v=e.getShapeTags,p=void 0===v?Ze:v;return new Promise((function(e,r){try{var o,s,d=window.localStorage.getItem("TRAINING_COLLECTION_ID");a({});var m=p(t),v=i[E],f=i[A],O=Object(le.a)(i,[E,A].map(Ge.a)),x=t.type,g=x.split("/"),y=Object(J.a)(g,1)[0],C=Object(h.a)(Object(h.a)({mimeType:x,mediaType:y},O),v&&(o={},Object(l.a)(o,E,!0),Object(l.a)(o,A,f),o)),I=Object(re.a)(C);K.z.createImportPlaceholder({metadataDocument:I,queryParams:Object(h.a)({container:1},c)}).then((function(e){var t=e.data;s=t.id;var a=[];return n&&(Array.isArray(n)?a=a.concat(n):a.push(n)),v&&a.push(d),a.length?Promise.all(a.map((function(e){return K.d.addCollectionEntity({collectionId:e,entityId:s})}))):Promise.resolve()})).then((function(){var e=b(),n=Object(h.a)(Object(h.a)({transferId:e,tag:m},v&&{noTranscode:!0,tag:[E],original:E}),u);return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((function(n,a){new K.a(e,Object(h.a)({onFail:function(e){return a(e)},onComplete:function(e){return n(e)}},t)).upload()}))}(t,Object(h.a)({api:{method:K.z.createImportComponentRaw,props:{itemId:s,component:"container",queryParams:n}},onProgress:a},j))})).then((function(t){e(Object(h.a)(Object(h.a)({},t),{},{itemId:s,collectionId:n}))})).catch((function(e){return r(e)}))}catch(T){console.error(T),r(T)}}))};function tt(e,t){for(var n=e.split(",").pop(),a=atob(n),r=new ArrayBuffer(a.length),i=new Uint8Array(r),o=0;o<a.length;o+=1)i[o]=a.charCodeAt(o);return new File([i],t,{type:"image/jpeg"})}var nt=function(e){var t=e.src,n=e.filename,a=e.onCrop,i=r.a.createRef(),o=r.a.useState({}),c=Object(J.a)(o,2),s=c[0],l=c[1];return Object(V.jsx)(_e.a,{ref:i,src:t,crop:s,onChange:function(e){return l(e)},onComplete:function(e,t){return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ae()().toISOString();return new Promise((function(a,r){var i=t.current;i||r(new Error("No image found"));var o=i.imageRef;o||r(new Error("No image found"));var c=o.current;c||r(new Error("No image found"));var s=c.naturalWidth,l=c.naturalHeight,u=e.x/100*s,d=e.y/100*l,j=e.width/100*s,m=e.height/100*l,b=document.createElement("canvas"),h=b.getContext("2d");b.width=j,b.height=m;try{h.drawImage(c,u,d,j,m,0,0,j,m)}catch(v){r(v)}a(tt(b.toDataURL("image/jpeg"),n))}))}(t,i,n).then(a).catch((function(){return null}))},onImageLoaded:function(e){var t=e.src;return URL.revokeObjectURL(t)}})},at={view:"search",selected:[],filename:"",collectionId:[]},rt=function(e){var t=e.open,n=e.onClose,a=e.onSuccess,i=e.onError,o=r.a.useState(null),c=Object(J.a)(o,2),s=c[0],u=c[1],d=r.a.useState(null),j=Object(J.a)(d,2),m=j[0],b=j[1],h=r.a.useState(!1),v=Object(J.a)(h,2),p=v[0],f=v[1],x=r.a.useState(at),g=Object(J.a)(x,2),y=g[0],C=g[1];r.a.useEffect((function(){var e;t&&(e=document.querySelector("video"),new Promise((function(t,n){var a=document.createElement("canvas"),r=a.getContext("2d"),i=e.videoWidth,o=e.videoHeight;a.width=i,a.height=o;try{r.drawImage(e,0,0,i,o)}catch(s){var c=s.message;n(c)}a.toBlob((function(e){try{var a=URL.createObjectURL(e);t(a)}catch(i){var r=i.message;n(r)}}))}))).then(u),t||URL.revokeObjectURL(s)}),[t]);var T=r.a.useMemo((function(){return!!p||("create"===y.view?y.filename.length<1:"search"===y.view&&y.selected.length<1)}),[p,y]);return Object(V.jsxs)(X.a,{open:t,onClose:n,children:[Object(V.jsxs)(Y.a,{disableTypography:!0,children:[Object(V.jsx)(I.a,{variant:"h6",children:"Capture face"}),Object(V.jsx)(I.a,{variant:"body2",children:"Make a selection by clicking and dragging the pointer over the image."}),Object(V.jsx)(I.a,{variant:"body2",children:"You may either add it to an existing resource or create a new face."})]}),Object(V.jsxs)($.a,{dividers:!0,children:[s&&Object(V.jsxs)(V.Fragment,{children:[Object(V.jsx)(nt,{src:s,onCrop:b}),Object(V.jsx)(qe,{allowCreate:!0,params:y,setParams:C})]}),!s&&Object(V.jsx)(Ne.a,{})]}),Object(V.jsxs)(te.a,{children:[Object(V.jsx)(O.a,{onClick:n,children:"Cancel"}),Object(V.jsx)(O.a,{disabled:T,variant:"contained",color:"primary",onClick:function(){var e=function(){return f(!p)},t=y.view,n=y.selected,r=y.filename,o=y.collectionId;if("search"===t){var c=Object(J.a)(n,1)[0].id,s={tag:[E],noTranscode:!0,createThumbnails:!0};return e(),K.q.createShapeImportRaw({itemId:c,file:m,queryParams:s}).then(a).catch(i)}if("create"===t){var u,d=o,j=(u={},Object(l.a)(u,A,r),Object(l.a)(u,E,!0),u);return et({file:m,metadata:j,collectionId:d,onProgress:e}).then(a).catch(i)}return null},children:"Add face"})]})]})},it=function(e){var t=e.open,n=e.onClose,a=e.onSuccess,i=e.onError,o=void 0===i?function(){return null}:i,c=r.a.useState(""),s=Object(J.a)(c,2),l=s[0],u=s[1],d=r.a.useMemo((function(){return l.length<1}),[l]);return Object(V.jsxs)(X.a,{open:t,onClose:n,children:[Object(V.jsx)(Y.a,{children:"Create collection"}),Object(V.jsx)($.a,{dividers:!0,children:Object(V.jsx)(Q.a,{value:l,required:!0,autoFocus:!0,margin:"dense",label:"New collection",type:"text",fullWidth:!0,onChange:function(e){var t=e.target;return u(t.value)}})}),Object(V.jsx)(te.a,{children:Object(V.jsx)(O.a,{onClick:function(){if(l){var e={name:l,metadata:Object(re.a)({title:l,vcs_face_isSampleCollection:!0})};K.d.createCollection({collectionDocument:e}).then((function(e){var t=e.data,n=(t=void 0===t?{}:t).id;return a(n)})).catch(o)}},color:"primary",variant:"contained",disabled:d,children:"Add"})})]})},ot={options:[{label:"ID",value:"itemId"},{label:"Name",value:A},{label:"Type",value:"type"}]},ct={itemSearchDocument:{filter:[{name:"training_material",operation:"AND",field:[{name:E,value:[{value:!0}]}]}]},queryParams:{field:[A,"itemId"],content:"metadata"},rowsPerPage:5},st=function(e){var t=e.open,n=e.onClose,a=e.shapeId,i=e.itemId,o=e.onSuccess,s=e.onError,l=void 0===s?function(){return null}:s,u=r.a.useState("search"),d=Object(J.a)(u,2),m=d[0],b=d[1],v=r.a.useState([]),p=Object(J.a)(v,2),f=p[0],x=p[1],g=r.a.useMemo((function(){return[0===f.length,f.length?f[0]:void 0]}),[f]),y=Object(J.a)(g,2),C=y[0],I=y[1];return Object(V.jsxs)(X.a,{open:t,onClose:n,children:[Object(V.jsx)(Y.a,{children:"Move resource"}),Object(V.jsxs)($.a,{dividers:!0,children:[Object(V.jsxs)(Z.a,{value:m,onChange:function(e,t){return t&&b(t)},variant:"fullWidth",textColor:"primary",indicatorColor:"primary",style:{marginBottom:"10px"},children:[Object(V.jsx)(ee.a,{value:"search",label:"Search",icon:Object(V.jsx)(ne.a,{})}),Object(V.jsx)(ee.a,{disabled:!0,value:"create",label:"Create",icon:Object(V.jsx)(ae.a,{})})]}),{search:Object(V.jsx)(c.p,{ItemTableProps:Object(h.a)({onRowClick:function(e){var t=e.id,n=e.metadata,a=[];if(!f.some((function(e){return e.id===t}))){var r=Object(re.f)(n,{flat:!0,arrayOnSingle:!1})[A];a.push({title:r,id:t})}x(a)},selected:f.map((function(e){return e.id}))},ot),searchProps:Object(j.A)(ct)}),create:null}[m]]}),Object(V.jsx)(te.a,{children:Object(V.jsx)(O.a,{onClick:function(){return function(e,t,n){return new Promise((function(a,r){K.q.getShape({itemId:t,shapeId:e}).then((function(i){var o=i.data;return K.q.createShape({itemId:n,shapeDocument:o}).then((function(n){var i=n.data.id;return K.q.removeShape({itemId:t,shapeId:e}).then((function(){return a(i)})).catch(r)})).catch(r)})).catch(r)}))}(a,i,I.id).then(o).catch(l)},color:"primary",variant:"contained",disabled:C,children:I?"Move to ".concat(I.title):"Move"})})]})},lt=function(e){var t=e.item,n=(t=void 0===t?{}:t).itemId,a=t.title,i=e.open,o=e.onClose,c=e.onSuccess,s=e.onError,l=void 0===s?function(){return null}:s,u=r.a.useState(a),d=Object(J.a)(u,2),j=d[0],m=d[1],b=r.a.useMemo((function(){return j===a}),[j,a]);return Object(V.jsxs)(X.a,{open:i,onClose:o,children:[Object(V.jsx)(Y.a,{children:"Rename resource"}),Object(V.jsx)($.a,{dividers:!0,children:Object(V.jsx)(Q.a,{value:j,required:!0,autoFocus:!0,margin:"dense",label:"Name",type:"text",fullWidth:!0,onChange:function(e){var t=e.target;return m(t.value)}})}),Object(V.jsx)(te.a,{children:Object(V.jsx)(O.a,{onClick:function(){j&&ce(n,j).then(c).catch(l)},color:"primary",variant:"contained",disabled:b,children:"Save"})})]})},ut=n(60),dt=n(385),jt=n(76),mt=n(276),bt=n(268),ht=function(e){var t=e.collectionId,n=e.resourceId,a=e.callbackId,r=Object(le.a)(e,["collectionId","resourceId","callbackId"]),i=K.x.vFetch,o="/API/collection/".concat(t,"/train"),c={resourceId:n,callbackId:a};return i(Object(h.a)({path:o,method:"POST",queryParams:c,body:{}},r))};var vt=function(e){var t=e.open,n=e.onClose,a=e.onSuccess,i=e.onError,o=e.resourceList,c=void 0===o?[]:o,s=Pe(),d=s.callbackId,j=s.trainingId,m=r.a.useState(),b=Object(J.a)(m,2),v=b[0],p=b[1],f=r.a.useRef(),x=r.a.useState(""),g=Object(J.a)(x,2),y=g[0],C=g[1];return r.a.useEffect((function(){return f.current={},Promise.all(c.map((function(e){var t=e.id;return ht({collectionId:j,analyzeJobDocument:{},queryParams:{resourceId:t,callbackId:d},costEstimate:!0})}))).then((function(e){return Promise.all(e.map((function(e){var t=e.data.id;return new Promise((function(e,n){!function a(){K.y.getCostEstimate({costEstimateId:t}).then((function(n){null!==f.current[t]&&(clearTimeout(f.current[t]),delete f.current[t]);var r=n.data;"FINISHED"===(r=void 0===r?{}:r).state?e(n):f.current[t]=setTimeout((function(){return a()}),1e3)})).catch((function(e){return n(e)}))}()}))})))})).then((function(e){var t=e.reduce((function(e,t){var n=t.data.service,a=void 0===n?[]:n,r=Object(J.a)(a,1)[0],i=r.cost,o=r.resource;return Object(h.a)(Object(h.a)({},e),{},Object(l.a)({},o,i))}),{});p(t)})).catch((function(){return p({})})),function(){null!==f.current&&Object.values(f.current).forEach((function(e){return clearTimeout(e)}))}}),[]),Object(V.jsxs)(X.a,{open:t,onClose:n,children:[Object(V.jsx)(Y.a,{children:"Train collection"}),Object(V.jsx)($.a,{dividers:!0,children:c.length>0?Object(V.jsx)(ut.a,{children:Object(V.jsx)(dt.a,{value:y,onChange:function(e){C(e.target.value)},children:c.map((function(e){var t=e.id,n=e.vidinet;return Object(V.jsx)(jt.a,{value:t,disabled:!v||void 0===v[t],control:Object(V.jsx)(mt.a,{}),label:"".concat(n?n.name:t).concat(v&&v[t]?" - $".concat(v[t].value.toFixed(2)):"")},t)}))})}):Object(V.jsx)(I.a,{children:"No VCS resources available."})}),Object(V.jsx)(u.a,{height:4,width:"100%",children:void 0===v&&Object(V.jsx)(bt.a,{variant:"query"})}),Object(V.jsxs)(te.a,{children:[Object(V.jsx)(O.a,{onClick:n,children:"Close"}),Object(V.jsx)(O.a,{variant:"contained",color:"primary",onClick:function(){return ht({collectionId:j,analyzeJobDocument:{},queryParams:{resourceId:y,callbackId:d}}).then(a).catch(i)},disabled:""===y,children:"Start"})]})]})},pt=Object(p.a)((function(e){return{root:Object(h.a)(Object(h.a)({},e.typography.h6),{},{textTransform:"none",opacity:.8,paddingLeft:0,marginRight:20,"&::after":{color:e.palette.primary.main,transition:"width 0.25s ease-in-out 0.05s",borderBottom:"0.25em solid",width:0,position:"absolute",bottom:0,left:0,content:'""'},"&:hover, &.selected":{opacity:1,backgroundColor:"unset","&::after":{width:"calc(100% - 8px)"}}})}}),{name:"VdtHeaderButtonLink"})(O.a);function ft(e){var t=e.userName,n=e.serverUrl,a=e.onLogout,i=Object(s.a)().t,o=Object(f.a)((function(e){return e.breakpoints.down("sm")})),l=be().showDialog,d=Ce().setNotification,j=pe().resource,m=void 0===j?[]:j,b=r.a.useMemo((function(){return window.location.href.split("server")[0]}),[]),h=Object(c.P)(),p=h.togglePalette,y=h.isDefaultPalette;return Object(V.jsx)(x.a,{position:"relative",children:Object(V.jsxs)(u.a,{px:2,py:.5,bgcolor:"#20232a",color:"common.white",width:"100%",display:"grid",gridTemplateColumns:o?"1fr auto":"auto 1fr auto",children:[Object(V.jsx)(u.a,{gridRow:o?"1":"initial",children:Object(V.jsx)(q,{subheader:n})}),Object(V.jsxs)(u.a,{display:"flex",justifyContent:"center",alignItems:"center",gridColumn:o?"1 / span 2":"initial",children:[Object(V.jsx)(pt,{activeClassName:"selected",variant:"text",component:v.c,to:"/import/",color:"inherit",disableRipple:!0,children:i("upload")}),Object(V.jsx)(pt,{activeClassName:"selected",variant:"text",component:v.c,to:"/item/",color:"inherit",disableRipple:!0,children:i("items")}),Object(V.jsx)(pt,{activeClassName:"selected",variant:"text",component:v.c,to:"/training/",color:"inherit",disableRipple:!0,children:i("Faces")}),Object(V.jsx)(O.a,{startIcon:Object(V.jsx)(C.a,{}),onClick:function(){return l({Dialog:vt,resourceList:m}).then((function(){return d({open:!0,message:"Training started"})})).catch((function(e){var t=e.message;return t&&d({open:!0,message:t,severity:"error"})}))},variant:"contained",color:"primary",disableRipple:!0,children:i("Train faces")})]}),Object(V.jsx)(u.a,{display:"flex",justifyContent:"flex-end",gridRow:o?"1":"initial",children:Object(V.jsx)(c.O,{userName:t,onLogout:a,togglePalette:function(){return p()},isDefaultPalette:y,locale:{set:function(e){return t=e,H.changeLanguage(t);var t},curr:H.language||"",options:[{label:"Svenska",value:"sv"},{label:"English",value:"en"},{label:"Deutsch",value:"de"}]},children:!P&&n&&Object(V.jsx)(g.a,{component:"a",href:b,children:i("Switch Server")})})})]})})}var Ot=n(28),xt=n(61),gt=n(56),yt=n(70),Ct=n.n(yt);function It(e){var t=e.icon,n=void 0===t?Ct.a:t,a=e.children,i=e.onOpen,o=void 0===i?function(){return null}:i,c=Object(le.a)(e,["icon","children","onOpen"]),s=r.a.useState(null),l=Object(J.a)(s,2),u=l[0],d=l[1],j=function(e){e.stopPropagation(),d(null)};return Object(V.jsxs)(V.Fragment,{children:[Object(V.jsx)(Ot.a,{component:gt.a,onClick:function(e){e.stopPropagation(),o(e),d(e.currentTarget)},disableRipple:!0,children:Object(V.jsx)(n,Object(h.a)({},c))}),Object(V.jsx)(xt.a,{onClick:j,anchorEl:u,keepMounted:!0,open:Boolean(u),onClose:j,elevation:1,PaperProps:{square:!0},getContentAnchorEl:null,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:a})]})}var Tt=n(55),St=n(30),wt=n(48),Pt=n(228),kt=n(229),Dt=n(273),Rt=n(598),Et=n(599),At=n(531),Lt=n(600),_t=n(601),Nt=n(117),Ft=n(179);var Mt=function(e){var t=e.open,n=e.onClose,a=e.itemId,i=Pe().callbackId,o=pe().resource,c=void 0===o?[]:o,s=r.a.useState(),d=Object(J.a)(s,2),j=d[0],m=d[1],b=r.a.useRef(),v=r.a.useState(""),p=Object(J.a)(v,2),f=p[0],x=p[1];return r.a.useEffect((function(){return b.current={},Promise.all(c.map((function(e){var t=e.id;return K.i.createItemAnalyze({itemId:a,analyzeJobDocument:{},queryParams:Object(h.a)({resourceId:t,jobmetadata:[{key:"cognitive_service_KeyframeInterval",value:1}]},i&&{callbackId:i}),costEstimate:!0})}))).then((function(e){return Promise.all(e.map((function(e){var t=e.data.id;return new Promise((function(e,n){!function a(){K.y.getCostEstimate({costEstimateId:t}).then((function(n){null!==b.current[t]&&(clearTimeout(b.current[t]),delete b.current[t]);var r=n.data;"FINISHED"===(r=void 0===r?{}:r).state?e(n):b.current[t]=setTimeout((function(){return a()}),1e3)})).catch((function(e){return n(e)}))}()}))})))})).then((function(e){var t=e.reduce((function(e,t){var n=t.data.service,a=void 0===n?[]:n,r=Object(J.a)(a,1)[0],i=r.cost,o=r.resource;return Object(h.a)(Object(h.a)({},e),{},Object(l.a)({},o,i))}),{});m(t)})).catch((function(){return m({})})),function(){null!==b.current&&Object.values(b.current).forEach((function(e){return clearTimeout(e)}))}}),[a]),Object(V.jsxs)(X.a,{open:t,onClose:n,children:[Object(V.jsx)(Y.a,{children:"Analyze"}),Object(V.jsx)(wt.a,{}),Object(V.jsx)($.a,{children:c.length>0?Object(V.jsxs)(ut.a,{children:[Object(V.jsx)(Ft.a,{children:"Choose Cognitive Service"}),Object(V.jsx)(dt.a,{value:f,onChange:function(e){x(e.target.value)},children:c.map((function(e){var t=e.id,n=e.vidinet;return Object(V.jsx)(jt.a,{value:t,control:Object(V.jsx)(mt.a,{}),label:"".concat(n?n.name:t).concat(j&&j[t]?" - $".concat(j[t].value.toFixed(2)):"")},t)}))})]}):Object(V.jsx)(I.a,{children:"No VCS resources available."})}),Object(V.jsx)(u.a,{height:4,width:"100%",children:void 0===j?Object(V.jsx)(bt.a,{variant:"query"}):Object(V.jsx)(wt.a,{})}),Object(V.jsxs)(te.a,{children:[Object(V.jsx)(O.a,{onClick:n,children:"Close"}),Object(V.jsx)(O.a,{variant:"contained",color:"primary",onClick:function(){return K.i.createItemAnalyze({itemId:a,analyzeJobDocument:{},queryParams:Object(h.a)({resourceId:f,jobmetadata:[{key:"cognitive_service_KeyframeInterval",value:1}]},i&&{callbackId:i})}).then((function(){return n()}))},disabled:""===f,children:"Start"})]})]})};function Ut(e){var t=e.mediaType,n=e.itemId,a=e.onCapture,r=Object(d.g)(),i=Ce().setNotification,o=Pe().isConfigured,s=be().showDialog;return Object(V.jsxs)(It,{children:[Object(V.jsxs)(g.a,{onClick:function(){return s({Dialog:Mt,itemId:n}).catch((function(){return null}))},disabled:"video"!==t,children:[Object(V.jsx)(Tt.a,{children:Object(V.jsx)(Rt.a,{})}),Object(V.jsx)(St.a,{primary:"Analyze"})]}),Object(V.jsxs)(g.a,{onClick:a,disabled:"video"!==t||!o,children:[Object(V.jsx)(Tt.a,{children:Object(V.jsx)(Et.a,{})}),Object(V.jsx)(St.a,{primary:"Capture face"})]}),Object(V.jsx)(wt.a,{}),Object(V.jsxs)(g.a,{onClick:function(){return s({Dialog:c.i,entity:"item",entityId:n,confirmButtonText:"Permanently delete item"}).then((function(){i({open:!0,message:"".concat(n," successfully removed")}),r.push("/item/")})).catch((function(e){var t=e.message;return t&&i({open:!0,message:t,severity:"error"})}))},children:[Object(V.jsx)(Tt.a,{children:Object(V.jsx)(At.a,{})}),Object(V.jsx)(St.a,{primary:"Delete",primaryTypographyProps:{color:"secondary"}})]})]})}function Vt(e){var t=e.itemType,n=void 0===t?{}:t,a=e.isLoading,i=e.onClose,o=e.linkTo,l=e.onCapture,u=Object(s.a)().t,d=n.metadata,m=n.shape,b=void 0===m?[]:m,h=n.id,p=r.a.useMemo((function(){return Object(re.f)(d,{joinValue:",",flat:!0})}),[d]),f=Object(J.a)(b,1)[0],O=p.title,x=p.mimeType,g=p.created,y=p.user,C=p.originalFilename,S=p.mediaType;return Object(V.jsxs)(Pt.a,{square:!0,elevation:0,style:{backgroundColor:"inherit"},children:[Object(V.jsx)(kt.a,{title:a?Object(V.jsx)(Nt.a,{variant:"rect",width:"50%",height:28}):O||C,avatar:a?Object(V.jsx)(Nt.a,{variant:"rect",width:40,height:40}):Object(V.jsx)(c.z,{avatar:x}),titleTypographyProps:{variant:"h5"},action:Object(V.jsxs)(V.Fragment,{children:[o&&Object(V.jsx)(Ot.a,{component:v.b,to:o,disableRipple:!0,children:Object(V.jsx)(Lt.a,{})}),Object(V.jsx)(j.f,{roleName:[re.i.ITEM_WRITE],allow:Object(V.jsx)(Ut,{onCapture:l,itemId:h,mediaType:S})}),i&&Object(V.jsx)(Ot.a,{component:gt.a,onClick:i,disableRipple:!0,children:Object(V.jsx)(_t.a,{})})]})}),Object(V.jsx)(Dt.a,{children:a?Object(V.jsx)(Nt.a,{variant:"rect",width:"10%",height:18}):Object(V.jsxs)(T.a,{container:!0,alignItems:"center",justifyContent:"space-between",children:[Object(V.jsx)(T.a,{item:!0,children:a?Object(V.jsx)(Nt.a,{variant:"rect",width:"10%",height:18}):Object(V.jsxs)(T.a,{container:!0,alignItems:"center",children:[Object(V.jsxs)(I.a,{variant:"body2",children:[u("createdBy"),"\xa0"]}),Object(V.jsx)(I.a,{variant:"subtitle2",children:y}),Object(V.jsx)(I.a,{variant:"body2",children:"\xa0on\xa0"}),Object(V.jsx)(I.a,{variant:"subtitle2",children:g?Ae()(g).format("ll"):""})]})}),Object(V.jsx)(T.a,{item:!0,children:a?Object(V.jsx)(Nt.a,{variant:"rect",width:"10%",height:18}):Object(V.jsx)(T.a,{container:!0,alignItems:"center",children:Object(V.jsx)(c.x,{shapeType:f})})})]})})]})}var qt=n(394),Bt=n(380),Wt=n(3),zt=n(277),Gt=n(91),Ht=n(602),Jt=Object(p.a)((function(e){return{root:{height:e.spacing(4),borderRadius:e.spacing(4),paddingRight:e.spacing(1),"&:hover":{backgroundColor:"".concat(e.palette.secondary.light,"4d !important")}},avatar:{height:"".concat(e.spacing(3),"px !important"),width:"".concat(e.spacing(3),"px !important")},deleteIcon:{width:"auto !important"},disabled:{opacity:"1 !important"}}}))(zt.a),Kt=Object(p.a)((function(e){var t=e.palette;return{root:{cursor:"pointer",transition:"background-color 0.3s ease-out","&:hover":{backgroundColor:"light"===t.type?"rgba(0, 0, 0, 0.1)":"rgba(0, 0, 0, 0.2)"}},isActive:{backgroundColor:"light"===t.type?"rgba(0, 0, 0, 0.2)":"rgba(0, 0, 0, 0.3)","&:hover":{backgroundColor:"light"===t.type?"rgba(0, 0, 0, 0.3)":"rgba(0, 0, 0, 0.4)"}}}}))((function(e){var t=e.start,n=e.end,a=e.metadata,i=e.classes,o=e.onSeek,c=e.isActive,s=e.onClick,d=r.a.createRef(),j=r.a.useMemo((function(){return a.find((function(e){return e.name===N})).group.map((function(e){var t=e.adu_av_value,n=void 0===t?"":t,a=e.adu_av_valueId,r=e.adu_av_confidence,i=e.group;return{unknown:n.includes("unknown_"),confidence:r,value:n,id:a,box:i}}))}),[a]),m=r.a.useMemo((function(){var e=Object(re.c)(t),a=Object(re.c)(n),r={samples:a.samples-e.samples,timeBase:a.timeBase};return{startText:e,endText:a,durationText:Object(re.d)(r)}}),[n,t]),b=m.startText,h=m.endText,v=m.durationText;r.a.useEffect((function(){c&&d&&d.current&&d.current.scrollIntoView({behavior:"smooth",block:"nearest"})}),[c]);var p=function(e,t){e.stopPropagation(),s(t)};return Object(V.jsxs)(u.a,{children:[Object(V.jsx)(u.a,{minHeight:50,p:2,ref:d,onClick:function(){return o(b.toSeconds())},className:Object(Wt.a)(i.root,Object(l.a)({},i.isActive,c)),children:Object(V.jsxs)(T.a,{container:!0,alignItems:"flex-start",wrap:"nowrap",children:[Object(V.jsx)(T.a,{item:!0,children:Object(V.jsxs)(T.a,{container:!0,direction:"column",children:[Object(V.jsx)(I.a,{variant:"caption",children:b.toSmpte()}),Object(V.jsx)(I.a,{variant:"caption",children:h.toSmpte()})]})}),Object(V.jsx)(T.a,{item:!0,style:{flexGrow:1},children:Object(V.jsx)(u.a,{px:2,children:j.map((function(e){var t=e.id,n=e.value,a=e.unknown,r=e.confidence;return Object(V.jsx)(Gt.a,{title:"I know this person, click to edit",placement:"top-start",children:Object(V.jsx)(Jt,{label:n,variant:"outlined",size:"small",clickable:!0,disabled:!a,onClick:function(e){return p(e,t)},onDelete:function(){return null},avatar:a?Object(V.jsx)(Ht.a,{}):null,deleteIcon:Object(V.jsx)("span",{children:Math.round(100*r)})},t)},t)}))})}),Object(V.jsx)(T.a,{item:!0,children:Object(V.jsx)(T.a,{container:!0,direction:"column",children:Object(V.jsx)(I.a,{variant:"caption",children:v.toDuration()})})})]})}),Object(V.jsx)(wt.a,{})]},t)})),Qt=function(e){var t=e.faces,n=void 0===t?[]:t,a=e.video,i=e.onClick,o=void 0===i?function(){return null}:i,c=r.a.useState(),s=Object(J.a)(c,2),l=s[0],u=s[1];r.a.useEffect((function(){if(a&&n.length>0){var e=function(){return function(e){var t=e.faces,n=e.video,a=void 0===n?{}:n,r=e.setActiveTimespanIndex,i=e.activeTimespanIndex,o=a.currentTime,c=Number((void 0===o?0:o).toFixed(3)),s=t.findIndex((function(e){var t=e.start,n=e.end,a=Object(re.c)(t),r=Object(re.c)(n),i=Number(a.toSeconds().toFixed(3)),o=Number(r.toSeconds().toFixed(3));return c>=i&&c<o}));i!==s&&r(s)}({faces:n,video:a,activeTimespanIndex:l,setActiveTimespanIndex:u})};return a.addEventListener("timeupdate",e),function(){a.removeEventListener("timeupdate",e)}}}),[a,n]);var d=r.a.useCallback((function(e){a&&(a.currentTime=e,0===a.played.length&&a.play())}),[a]);return Object(V.jsx)(Bt.a,{style:{height:500},totalCount:n.length,itemContent:function(e){var t=n[e],r=l===e;return Object(V.jsx)(Kt,{isActive:r,start:t.start,end:t.end,metadata:t.group,video:a,onSeek:d,onClick:o},t.start+t.end)}})},Xt=function(e){var t=e.onChange,n=e.confidenceText,a=void 0===n?"Confidence":n,i=r.a.useCallback(b()(t,500)),o=r.a.useState(50),c=Object(J.a)(o,2),s=c[0],l=c[1];return Object(V.jsxs)(V.Fragment,{children:[Object(V.jsx)(I.a,{variant:"caption",gutterBottom:!0,children:a}),Object(V.jsx)(qt.a,{defaultValue:50,valueLabelDisplay:"auto",step:5,marks:!0,min:0,max:100,value:s,onChange:function(e,t){l(t),i(t/100)}})]})},Yt=Object(p.a)((function(e){var t=e.palette,n=e.spacing;return{faceList:{overflowY:"scroll",height:"100%",maxHeight:540,"&::-webkit-scrollbar":{WebkitAppearance:"none"},"&::-webkit-scrollbar:vertical":{width:11},"&::-webkit-scrollbar-thumb":{borderStyle:"solid",borderWidth:2,borderColor:t.common.white,backgroundColor:"rgba(0, 0, 0, 0.5)"}},searchInput:{flexGrow:1,paddingLeft:n(1)}}}))((function(e){var t=e.itemType,n=e.video,a=e.classes,i=e.onRefresh,o=be().showDialog,s=Ce().setNotification,l=r.a.useMemo((function(){return function(e){var t=e.itemType,n=t.metadata,a=t.thumbnails,r=(a=void 0===a?{}:a).uri,i=void 0===r?[]:r,o={includeTimespanAttributes:!0,includeGroupAttributes:!0,flatTimespan:!0,flatGroup:!0,groupAsList:!0,joinValue:","},c=(n||{}).timespan;return(void 0===c?[]:c).sort(re.j).map((function(e){return Object(re.h)(e,o)})).reduce((function(e,t){var n=t.start,a=i.find((function(e){return e.includes(n)}));return[].concat(Object(ie.a)(e),[Object(h.a)(Object(h.a)({},t),{},{thumbnail:a})])}),[])}({itemType:t})}),[t]),d=r.a.useState(.5),j=Object(J.a)(d,2),m=j[0],b=j[1],v=r.a.useState(""),p=Object(J.a)(v,2),f=p[0],O=p[1],x=r.a.useMemo((function(){return function(e,t,n){return n.filter((function(n){var a=n.group,r=((void 0===a?[]:a).find((function(e){return e.name===N}))||{}).group,i=void 0===r?[]:r;return!!i.length&&i.some((function(n){var a=n.adu_av_value,r=n.adu_av_confidence;return a?a.toString().toLowerCase().includes(e.toLowerCase())&&r>=t:r>=t}))}))}(f,m,l)}),[f,m,l]);return Object(V.jsxs)(u.a,{children:[Object(V.jsxs)(T.a,{container:!0,alignItems:"center",children:[Object(V.jsx)(T.a,{item:!0,className:a.searchInput,children:Object(V.jsx)(c.t,{setFilterText:O,filterText:f})}),Object(V.jsx)(T.a,{item:!0,style:{flexGrow:.5,marginLeft:5,marginRight:5},children:Object(V.jsx)(Xt,{onChange:b})})]}),Object(V.jsx)("div",{className:a.faceList,children:Object(V.jsx)(Qt,{faces:x,video:n,onClick:function(e){var t={content:["metadata"],field:["__collection:parentId","itemId","".concat(A,":title")]},n={operator:{field:[{name:_,value:[{value:e}]}],operation:"OR"}};K.i.searchItem({itemSearchDocument:n,queryParams:t}).then((function(e){var t=e.data,n=(void 0===t?{}:t).item;n=void 0===n?[{}]:n;var a=Object(J.a)(n,1)[0].metadata;if(a){var r=Object(re.f)(a,{flat:!0,arrayOnSingle:!1});o({Dialog:ze,allowCreate:!0,item:r}).then((function(){return s({open:!0,message:"Success!"})})).catch((function(e){var t=e.message;return t&&s({open:!0,message:t,severity:"error"})})).then(i)}}))}})})]})}));function $t(e){var t=e.itemId,n=e.videoEl,a=e.sampleRate,i=void 0===a?"PAL":a,o={content:["metadata"],group:[N,"adu_av_analyzedValue"],field:[F,M,U],sampleRate:i,"noauth-url":!0},c=r.a.useState(null),s=Object(J.a)(c,2),l=s[0],u=s[1],d=function e(){n.current&&!l?u(n.current.player.videoEl):null===l&&setTimeout(e,1e3)};return r.a.useEffect(d,[d]),Object(V.jsx)(j.e,{itemId:t,queryParams:o,children:Object(V.jsx)(Yt,{video:l,sampleRate:i})})}var Zt=function(e){e.onClick;var t=e.container,n=(e.classes,r.a.useState(!1)),a=Object(J.a)(n,2),i=a[0],c=a[1];return r.a.useEffect((function(){i||(t.innerHTML="",t.title="Capture face",t.style.overflow="hidden",c(!0))}),[i]),i?o.a.createPortal(Object(V.jsx)(u.a,{height:1,width:1,display:"flex",alignItems:"center",justifyContent:"center",children:Object(V.jsx)(C.a,{})}),t):null},en=Object(p.a)((function(e){e.palette;return{button:{zIndex:10,height:"44px !important",cursor:"pointer"}}}))((function(e){var t=e.screenshotRef,n=(e.onClick,e.classes),a=r.a.useState(null),i=Object(J.a)(a,2),o=i[0],c=i[1];return r.a.useEffect((function(){!function e(){t.current?c(document.querySelector(".vdt-screenshot-button")):setTimeout(e,250)}()}),[]),o?Object(V.jsx)(Zt,{container:o,classes:n}):null})),tn={content:["metadata","shape"],tag:"original",field:["title","mimeType","mediaType","created","user","originalFilename"],interval:"generic"},nn={content:["thumbnail","metadata","shape"],methodMetadata:[{key:"format",value:"SIGNED-AUTO"}],"noauth-url":!0,group:"stl_subtitle",field:"stl_text",sampleRate:"PAL"};function an(e){var t=e.itemId,n=e.startSeconds,a=e.endSeconds,i=e.EntityCommentComponent,o=void 0===i?c.h:i,l=e.isCinema,m=void 0!==l&&l,b=e.ItemHeaderProps,v=void 0===b?{}:b,p=e.onVideoEnd,f=Object(s.a)().t,O=Object(d.i)().itemId,x=be().showDialog,g=Ce().setNotification,y=Pe(),C=y.isConfigured,I=y.isLoading,S=t||O,w=new URLSearchParams(Object(d.h)().search),P=Number(w.get("t")||n),k=a,D=r.a.useRef(P),R=r.a.createRef();r.a.useEffect((function(){D.current&&R.current&&D.current!==P&&(D.current=P,R.current.player.videoEl.currentTime=P)}),[P,R]);var E=r.a.useState(m),A=Object(J.a)(E,2),L=A[0],_=A[1],N=[{label:f("Faces"),component:$t},{label:f("formats"),component:c.q,hideOnMount:!0}],F=r.a.useRef(!1),M=function(){return x({Dialog:rt,videoEl:R.current}).then((function(){return g({open:!0,message:"Import job started"})})).catch((function(e){var t=e.message;return t&&g({open:!0,message:t,severity:"error"})}))};return I?null:Object(V.jsx)(V.Fragment,{children:Object(V.jsxs)(u.a,{children:[Object(V.jsx)(en,{screenshotRef:F,onClick:M}),Object(V.jsxs)(T.a,{container:!0,justifyContent:"space-between",children:[Object(V.jsxs)(T.a,{item:!0,style:{width:L?"100%":"50%",marginLeft:L?8:0,marginRight:L?8:0,transition:"width 0.5s, margin 0.5s"},children:[Object(V.jsx)(j.e,{itemId:S,queryParams:tn,children:Object(V.jsx)(Vt,Object(h.a)(Object(h.a)({},v),{},{onCapture:M}))}),Object(V.jsx)(j.e,{itemId:S,queryParams:nn,children:Object(V.jsx)(c.n,{itemId:S,videoEl:R,subtitleGroup:nn.group,subtitleField:nn.field,onCinema:function(e){return _(e)},onScreenshot:M,ItemVideoPlayerProps:{onScreenshotSuccess:function(){return g({open:!0,message:"Screenshot Job Started"})},onScreenshotError:function(){return g({open:!0,message:"Error Starting Screenshot Job",severity:"error"})}},videoPlayerProps:Object(h.a)(Object(h.a)({},C&&{crossOrigin:"anonymous"}),{},{controlsBelowPlayer:!0,onReady:function(e){Number.isNaN(P)||(e.currentTime(P),e.poster("")),F.current=!0,p&&e.on("ended",p),p&&void 0!==k&&0!==k&&e.on("timeupdate",(function(){e.currentTime()>=k&&(e.pause(),p())}))}}),audioPlayerProps:{onReady:function(e){setTimeout((function(){e.play()}),500),p&&e.on("ended",p)}}})}),o&&Object(V.jsx)(o,{entityId:S,entity:"item",playerRef:R})]}),Object(V.jsx)(T.a,{xs:12,lg:L?12:6,item:!0,children:Object(V.jsx)(c.s,{tabs:N,itemId:S,videoEl:R,onError:function(e){return g({open:!0,message:e.message,severity:"error"})}})})]})]})})}var rn=n(119);function on(e){var t=e.setSearchFilter,n=e.initialSearchFilter,a=e.itemListType,i=void 0===a?{facet:[]}:a,o=e.filterFields,l=void 0===o?[]:o,u=Object(s.a)().t,d=l.map((function(e){var t=e.label,n=Object(le.a)(e,["label"]);return Object(h.a)(Object(h.a)({},n),{},{label:u(n.value,t)})})),j=r.a.useCallback(b()(t,400),[t]);return Object(V.jsx)(c.l,{itemListType:i,onChange:j,fields:d,initialSearchFilter:n,CardProps:{elevation:0,square:!0,variant:"outlined"},hideEmptyFilters:!0})}var cn=function(e){var t=e.thumbnail;return Object(V.jsx)("img",{style:{maxWidth:"60px",maxHeight:"40px",position:"absolute",top:0,bottom:0,margin:"auto"},alt:"Thumbnail",src:t})},sn=function(e){var t=e.avatar,n=e.innerProps,a=n.itemId,r=n.collectionId,i=n.itemType,o=void 0===i?{}:i,s=n.entityTimespan,l=(s=void 0===s?{}:s).start,u=void 0===l?0:l,d=Object(re.c)(u),j=Object(re.b)(o,u);return Object(V.jsx)("div",{children:Object(V.jsx)(v.b,{to:r?"/collection/".concat(r):"/item/".concat(a).concat(u?"?t=".concat(d.toSeconds()):""),children:Object(V.jsx)(c.z,{MimeTypeProps:{mimeType:r?"collection":t,thumbnail:j},MimeTypeComponent:j?cn:void 0})})})},ln=Object(p.a)({},{name:"CustomBinItem"})((function(e){var t=e.entityTimespan,n=r.a.useCallback((function(){return t?"".concat(Object(re.c)(t.start).toSmpte()," - ").concat(Object(re.c)(t.end).toSmpte()):void 0}),[t]),a=r.a.useCallback((function(e){var t=e.originalFilename,n=e.title,a=e.itemId,r=e.collectionId;return n||(t||(n||t||a||r))}),[]);return Object(V.jsx)(c.g,Object(h.a)({titleSelector:a,subheaderSelector:n,AvatarComponent:sn,imageSelector:function(){},ThumbnailComponent:null,ContentComponent:null,ActionsComponent:null},e))})),un=Object(j.l)(Object(p.a)({isDragging:{opacity:0}},{name:"CustomBinItemDraggable"}),c.Q)(ln);function dn(){var e=r.a.useContext(j.a),t=e.bin,n=e.allowDuplicates,a=e.setBin,i=e.setAllowDuplicates,o=e.onDrop,s=e.onSort,l=e.onDelete,u=e.onEmptyBin,m=Ce().setNotification,b=Object(d.g)(),h=r.a.useContext(c.e),v=h.DraggedComponent,p=h.setDraggedComponent;return r.a.useEffect((function(){return v||p(ln),function(){v&&p(null)}}),[v,p]),Object(V.jsx)(c.a,{bin:t,allowDuplicates:n,setBin:a,onDrop:o,onSort:s,onDelete:l,onEmptyBin:u,onAllowDuplicates:i,onAddToCollectionSuccess:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return m({open:!0,message:"Added to ".concat(e.join(",")),severity:"success"})},BinItemComponent:un,BinItemProps:{DraggedComponent:ln},CollectionCreateDialogProps:{onSuccess:function(e){var t=e.id;return b.push("/collection/".concat(t,"/"))}},BinProps:{elevation:0,square:!0,variant:"outlined"}})}var jn=[{label:"Created by",value:"created"},{label:"Title",value:"title"}];var mn=Object(p.a)((function(e){return{root:{height:"95%",width:"100%"},resultContainer:{height:"inherit",width:"inherit",display:"flex"},filterContainer:{minWidth:220,marginBottom:e.spacing(1)},leftResultContainer:{flexDirection:"column",marginRight:e.spacing(2)},rightResultContainer:{flexGrow:1,minWidth:"0%"},QueryBuilderContainer:{marginBottom:e.spacing(1)}}}))((function(e){var t=e.classes,n=e.children,a=e.setSearchText,i=e.isLoading,o=e.sortOptions,l=void 0===o?jn:o,u=e.onChangeSort,d=e.onChangePage,m=e.onChangeRowsPerPage,v=e.page,p=e.rowsPerPage,f=e.itemSearchDocument,O=e.layout,x=e.onChangeViewLayout,g=e.itemListType,y=e.setSearchFilter,C=void 0===y?function(){return null}:y,I=e.filterFields,S=e.withBin,w=void 0!==S&&S,P=e.BinProps,k=void 0===P?{}:P,D=e.onRefresh,R=r.a.useRef(null),E=r.a.useMemo((function(){return f.text&&f.text.length>0&&f.text[0].value||""}),[f.text]),A=f.sort,L=Object(s.a)().t,_=Object(j.r)(),N=_.suggestions,F=_.setAutocompleteText,M=r.a.useRef(b()(F,200)).current,U=i?v*p+1:0,q=r.a.useMemo((function(){return A&&A.length?{option:l.find((function(e){return e.value===A[0].field})),direction:A[0].order}:void 0}),[A,l]),B=r.a.useCallback((function(e){a(e),R.current.value=e}),[R,a]),W=g.suggestion,z=void 0===W?[]:W,G=g.hits,H=void 0===G?0:G,K=f.text;K=void 0===K?[]:K;var Q=Object(J.a)(K,1)[0],X=(Q=void 0===Q?{}:Q).value,Y=r.a.useState(),$=Object(J.a)(Y,1)[0],Z=r.a.useRef(b()(C,200)).current;return Object(V.jsxs)("div",{className:t.root,children:[Object(V.jsxs)(T.a,{container:!0,alignItems:"center",justifyContent:"flex-start",children:[Object(V.jsx)(T.a,{item:!0,sm:8,md:4,lg:6,children:Object(V.jsx)(T.a,{container:!0,wrap:"nowrap",children:Object(V.jsx)(c.E,{defaultValue:E,onSubmit:a,submitting:i,searchPlaceholder:L("searchItems"),onChange:M,SuggestionsComponent:c.F,suggestions:N,inputRef:R,ButtonProps:{onClick:function(){if(R){var e=R.current.value;e&&X!==e?a(e):D()}},type:"button"}})})}),Object(V.jsx)(T.a,{item:!0,sm:4,md:8,lg:6,children:Object(V.jsxs)(T.a,{container:!0,alignItems:"center",justifyContent:"flex-end",children:[l&&Object(V.jsx)(T.a,{item:!0,children:Object(V.jsx)(rn.a,{smDown:!0,children:Object(V.jsx)(c.I,{options:l.map((function(e){return{label:L(e.label),value:e.value}})),initialSort:q,onChange:u})})}),void 0!==v&&Object(V.jsx)(T.a,{item:!0,children:Object(V.jsx)(rn.a,{smDown:!0,children:Object(V.jsx)(c.D,{onChangePage:d,onChangeRowsPerPage:m,count:H||U,page:v,rowsPerPage:p})})}),void 0!==O&&Object(V.jsx)(T.a,{item:!0,children:Object(V.jsx)(c.v,{viewLayout:O,onChangeViewLayout:x})})]})})]}),Object(V.jsxs)("div",{className:t.resultContainer,children:[(w||I)&&Object(V.jsx)(rn.a,{smDown:!0,children:Object(V.jsxs)("div",{className:t.leftResultContainer,children:[I&&Object(V.jsx)("div",{className:t.filterContainer,children:Object(V.jsx)(on,{setSearchFilter:Z,initialSearchFilter:f.filter,isLoading:i,itemListType:g,filterFields:I},$)}),w&&Object(V.jsx)(dn,Object(h.a)({},k))]})}),Object(V.jsxs)("div",{className:t.rightResultContainer,children:[z&&z.length>0?Object(V.jsx)(c.J,{searchText:X,suggestions:z,onClick:B}):null,n]})]})]})})),bn=function(e){return function(t){var n=t.innerProps,a=void 0===n?{}:n,r=a.itemId,i=a.itemType,o=(i=void 0===i?{}:i).start,c="/item/".concat(r);return o&&"-INF"!==o&&(c+="?t=".concat(Object(re.c)(o).toSeconds())),Object(V.jsx)(v.b,{to:c,children:Object(V.jsx)(e,Object(h.a)({},t))})}},hn=Object(j.l)(Object(p.a)({isDragging:{opacity:.5}},{name:"MediaCardHeaderDraggable"}),c.Q)(c.A),vn=function(e){var t=e.created;return t?Ae()(t).format("ll"):""},pn=function(e,t){var n=e.originalFilename,a=e.title,r=e.itemId,i=t.title;if("string"===typeof i){var o=i.indexOf(D),c=i.indexOf(R),s=i.slice(0,o),l=i.slice(c).replace(R,""),u=i.slice(o,c).replace(D,""),d=l.split(D).reduce((function(e,t){if(t.includes(R)){var n=t.split(R),a=Object(J.a)(n,2),r=a[0],i=a[1],o=[].concat(Object(ie.a)(e),[Object(V.jsx)("strong",{children:r},r)]);return i&&o.push(Object(V.jsx)("em",{children:i},i)),o}return t?[].concat(Object(ie.a)(e),[t]):e}),[]);if(u)return Object(V.jsxs)(V.Fragment,{children:[s,Object(V.jsx)("strong",{children:u}),d]})}return a||(n||r)},fn=bn(c.B);function On(e){var t=Object(f.a)((function(e){return e.breakpoints.up("sm")}));return Object(V.jsx)(V.Fragment,{children:Object(V.jsx)(c.m,Object(h.a)({ItemCardProps:{titleSelector:pn,subheaderSelector:vn,ThumbnailComponent:fn,HeaderComponent:hn,MenuComponent:null,ContentComponent:null,ActionsComponent:null,titleTypographyProps:{noWrap:!0,style:{width:220}},subheaderTypographyProps:{noWrap:!0,style:{width:220}}},GridContainerProps:{justifyContent:t?"flex-start":"space-evenly"},GridItemProps:{style:{paddingRight:8,paddingBottom:8}}},e))})}var xn=n(120),gn=function(e){var t=e.value;return t?Ae()(t).format("ll"):""},yn=function(e){var t=e.value;return t?function(e){var t=Math.floor(e/3600),n=Math.floor(e%3600/60),a=Math.floor(e%60);return[t.toString().padStart(2,"0"),n.toString().padStart(2,"0"),a.toString().padStart(2,"0")].join(":")}(t):""},Cn=function(e){var t=e.innerProps,n=void 0===t?{}:t,a=n.itemType,r=void 0===a?{}:a,i=n.itemId,o=r.thumbnails,c=(void 0===o?{}:o).uri,s=void 0===c?[]:c,l=s[Math.floor(s.length/2)];return Object(V.jsx)(v.b,{to:"/item/".concat(i),children:l?Object(V.jsx)("img",{src:l,width:80,alt:""}):Object(V.jsx)("div",{style:{backgroundColor:"rgba(0,0,0,0.1)",width:80,height:45}})})},In=function(e){var t=e.value;return Object(V.jsx)(xn.a,{variant:"square",children:Object(V.jsx)(c.C,{mimeType:t})})},Tn=Object(c.Q)(c.o);function Sn(e){var t=e.itemListType,n=Object(s.a)().t;return Object(V.jsx)(c.r,{itemListType:t,RowComponent:Tn,wrapDragInDiv:!1,options:[{label:"",value:"mimeType",valueComponent:In},{label:"",valueComponent:Cn},{label:n("title"),value:"title"},{label:n("created"),value:"created",valueComponent:gn,hide:"xs"},{label:n("durationSeconds"),value:"durationSeconds",valueComponent:yn,hide:"xs"}]})}var wn=n(523),Pn=n(97),kn=n(233),Dn=n(128),Rn=n.n(Dn);var En=Object(p.a)((function(e){return{openSearch:{marginLeft:"auto"},formLabelContainer:{display:"flex"},popOver:{padding:e.spacing(1,2),width:"28vw",minHeight:"34vh"},searchInput:{width:250,padding:e.spacing(2),display:"block","& button":{display:"none"}},markAll:{padding:e.spacing(0,2)},filtersContainer:{display:"flex",alignContent:"baseline",flexWrap:"wrap",minHeight:"18vh",overflow:"auto",marginBottom:e.spacing(2),padding:e.spacing(2)},filter:{flex:"1 32%"},setSelection:{display:"block",marginLeft:"auto",margin:e.spacing(1)}}}),{name:"VdtSearchInFilters"})((function(e){var t=e.options,n=void 0===t?[]:t,a=e.onChange,i=e.label,o=e.classes,l=Object(s.a)().t,u=r.a.useState(),d=Object(J.a)(u,2),j=d[0],m=d[1],b=r.a.useState([]),h=Object(J.a)(b,2),v=h[0],p=h[1],f=r.a.useState(null),x=Object(J.a)(f,2),g=x[0],y=x[1],C=function(){y(null)};r.a.useEffect((function(){n&&m(n.slice(1))}),[n]);var I=function(e){var t=e.target.value;v.includes(t)?p((function(e){return e.filter((function(e){return e!==t}))})):p((function(e){return[].concat(Object(ie.a)(e),[t])}))};return Object(V.jsxs)(V.Fragment,{children:[Object(V.jsxs)("div",{className:Object(Wt.a)(o.formLabelContainer,"VdtCheckboxGroupField-formLabelContainer"),children:[Object(V.jsx)(Ft.a,{component:"legend",children:i}),Object(V.jsx)(O.a,{className:o.openSearch,size:"small",type:"submit",onClick:function(e){var t=e.currentTarget;y(t)},disableRipple:!0,children:Object(V.jsx)(Rn.a,{})})]}),Object(V.jsxs)(wn.a,{classes:{paper:o.popOver},open:Boolean(g),anchorEl:g,onClose:C,anchorOrigin:{vertical:"center",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"left"},children:[Object(V.jsx)(c.L,{classes:{root:o.searchInput},onChange:function(e){var t=e.target.value,a=n.slice(1).filter((function(e){return e.value.toLowerCase().startsWith(t.toLowerCase())}));m(a)},label:i,helperText:null,InputProps:{endAdornment:Object(V.jsx)(Pn.a,{position:"end",children:Object(V.jsx)(Rn.a,{})})}}),Object(V.jsx)(jt.a,{className:o.markAll,label:l("markAll"),onChange:function(){v.length===j.length?p([]):p(j.map((function(e){return e.value})))},control:Object(V.jsx)(kn.a,{checked:v.length===n.slice(1).length})}),Object(V.jsx)(wt.a,{}),Object(V.jsx)("div",{className:o.filtersContainer,children:j&&j.map((function(e){return Object(V.jsx)(jt.a,{onChange:I,label:e.value,classes:{root:o.filter},control:Object(V.jsx)(kn.a,{name:e.value,value:e.value,checked:v.includes(e.value)})},e.value)}))}),Object(V.jsx)(O.a,{className:o.setSelection,variant:"contained",color:"primary",onClick:function(){v.length>0&&(a(v),p([]),C())},children:l("setSelection")})]})]})})),An=[{value:"title",component:c.L},{value:"mediaType",component:c.b,FormControlLabelComponent:c.k,FacetProps:{count:!0,exclude:["mediaType"]},parseOptions:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.keys(e).map((function(t){return{value:t,label:"".concat(t," (").concat(e[t],")")}}));return t.unshift({value:"*",label:"Any Media Type "}),t},selectAllValue:"*",FormLabelComponent:En},{value:"originalVideoCodec",component:c.G,FacetProps:{count:!0}},{value:"originalAudioCodec",component:c.G,FacetProps:{count:!0}},{value:"originalHeight",showMarks:!1,component:c.H,isRange:!0,exclude:!0,FacetProps:{count:!0}},{value:"mimeType",label:"Mime Types",component:c.K,parseOptions:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.keys(e).map((function(e){return{value:e,label:e}}))},freeSolo:!0,FacetProps:{count:!0},AutocompleteProps:{multiple:!0}}],Ln={itemSearchDocument:{intervals:"all",highlight:{matchingOnly:!1,prefix:D,suffix:R,field:["title"]},facet:An.filter((function(e){var t=e.FacetProps;return!0===(void 0===t?{}:t).count})).map((function(e){var t=e.value,n=e.exclude,a=e.FacetProps;a=void 0===a?{}:a;var r=Object.assign({},a),i=n?{exclude:Array.isArray(n)?n:[t]}:{};return Object(h.a)(Object(h.a)({field:t,name:t},i),r)})),filter:[],suggestion:{maximumSuggestions:3,accuracy:.7}},queryParams:{field:["title","originalFilename","created","user","durationSeconds","mimeType","itemId"],content:["metadata","thumbnail"],"noauth-url":!0}},_n={operation:"NOT",field:[{name:E,value:[{value:!0}]}]},Nn="GRID_VIEW";function Fn(e){var t=e.isConfigured,n=Object(d.g)(),a=Object(j.y)({history:n,defaultState:Object(h.a)(Object(h.a)({},Ln),t&&{itemSearchDocument:Object(h.a)(Object(h.a)({},Ln.itemSearchDocument),{},{operator:_n})})}).queryInitialState,i=Object(j.A)(a),o=i.state,c=i.setSearchText,s=i.setItemSearchDocument,l=i.onChangeRowsPerPage,u=i.onChangePage,m=i.onChangeSort,b=i.setSearchFilter,v=o.matrixParams,p=o.queryParams,f=o.itemSearchDocument,O=o.page,x=o.rowsPerPage;Object(j.C)({history:n,state:o});var g,y=Object(j.B)({itemSearchDocument:f,queryParams:p,matrixParams:v}),C=y.itemListType,I=y.isLoading,T=y.onRefresh,S=r.a.useState("GRID_VIEW"),w=Object(J.a)(S,2),P=w[0],k=w[1];switch(P){case Nn:g=On;break;case"ROW_VIEW":g=Sn;break;default:g=On}return Object(V.jsx)(mn,{itemSearchDocument:f,itemListType:C,setSearchText:c,isLoading:I,onChangeSort:m,onChangePage:u,onChangeRowsPerPage:l,page:O,rowsPerPage:x,onChangeViewLayout:function(e,t){return k(t)},layout:P,setItemSearchDocument:s,setSearchFilter:b,filterFields:An,withBin:!0,onRefresh:T,children:Object(V.jsx)(g,{itemListType:C})})}var Mn=function(){var e=Pe(),t=e.isConfigured;return e.isLoading?Object(V.jsx)(Ne.a,{}):Object(V.jsx)(Fn,{isConfigured:t})},Un=n(107),Vn=Object(p.a)((function(e){return{form:{"& > *":{marginTop:e.spacing(1.5),marginBottom:e.spacing(1.5)}}}}),{name:"VdtUploadForm"})((function(e){var t=e.classes,n=e.onChange,a=e.values,i=r.a.useMemo((function(){return!0===a[E]}),[a]);return Object(V.jsx)("div",{className:t.root,children:Object(V.jsxs)("div",{className:t.form,children:[!i&&Object(V.jsx)(Q.a,{onChange:n("title"),value:a.title,label:"Title",variant:"outlined",required:!0,fullWidth:!0,InputLabelProps:{shrink:!0}}),i&&Object(V.jsx)(Q.a,{onChange:n(A),value:a[A],label:"Name",variant:"outlined",required:!0,fullWidth:!0,InputLabelProps:{shrink:!0}}),Object(V.jsx)(jt.a,{control:Object(V.jsx)(Un.a,{onChange:n(E),checked:i,label:"Training material"}),label:"Training material"})]})})}));function qn(){var e=r.a.useContext(Ie),t=e.useUploadFiles,n=e.contextFiles,a=e.setContextFiles;return Object(V.jsx)(c.N,{useUploadFiles:t,contextFiles:n,setContextFiles:a,UploadEditorProps:{UploadFormComponent:Vn}})}var Bn=n(35),Wn=n.n(Bn),zn=n(214),Gn=n(389),Hn=n(390),Jn=n(96);var Kn=function(e){var t=e.innerProps.collectionId,n=e.checked;return Object(V.jsx)(kn.a,{value:t,checked:n})},Qn=Object(j.l)(Object(p.a)((function(e){return{root:{flexGrow:1,maxWidth:"unset",cursor:"pointer",boxShadow:e.shadows[1],transition:"all 0.3s ease","& .MuiCardHeader-root":{paddingRight:8,transition:"all 0.3s ease"},"& .MuiCardHeader-action":{alignSelf:"unset"},"& .MuiIconButton-root":{transition:"all 0.3s ease"},"&:hover":{"& .MuiIconButton-root":{color:e.palette.secondary.main}}},canDrop:{borderColor:e.palette.primary.main},isOver:{"& .MuiCardHeader-root":{backgroundColor:e.palette.primary.main}}}})),c.R)(c.c),Xn=function(e){var t=e.onClick,n=e.onDrop,a=e.checked,r=e.collectionType,i=r.id;return Object(V.jsx)(Qn,{CardProps:{onClick:function(){return t(i)}},onDrop:n,collectionType:r,collectionId:r.id,AvatarComponent:Kn,checked:a,subheaderSelector:function(e){var t=e.items;return"".concat(t," ").concat(1===Number(t)?"face":"faces")},titleTypographyProps:{},subheaderTypographyProps:{}})},Yn={queryParams:{field:["collectionId","title","__items_size:items"],content:"metadata"},rowsPerPage:5,itemSearchDocument:{}},$n=Object(j.l)(Object(p.a)((function(e){return{root:{borderWidth:2,borderStyle:"dashed",width:"100%",transition:"all 0.3s ease",borderColor:"transparent"},canDrop:{borderColor:e.palette.primary.main},isOver:{backgroundColor:e.palette.primary.main}}})),c.R)(O.a),Zn=function(e){var t=e.collectionId,n=e.setCollectionId,a=e.onRefresh,r=be().showDialog,i=Pe().trainingId,o=Ce().setNotification,s=Object(j.A)(Object(h.a)(Object(h.a)({},Yn),{},{itemSearchDocument:Object(h.a)({},i&&{operator:{field:[{name:"collectionId",value:[{value:i}]}],operation:"NOT"}})})),l=s.state,d=(l=void 0===l?{}:l).itemSearchDocument,m=l.queryParams,b=l.matrixParams,v=l.rowsPerPage,p=s.setSearchText,f=s.onChangeRowsPerPage,x=function(e){var t=e.itemSearchDocument,n=e.queryParams,a=e.matrixParams,r=Object(j.q)(K.d.searchCollection),i=r.request,o=r.data,c=void 0===o?{}:o,s=r.isLoading,l=r.isError,u=function(){return i({itemSearchDocument:t,queryParams:n,matrixParams:a})};return Object(Jn.a)((function(){u()}),[t,n,a]),{collectionListType:c,isLoading:s,isError:l,onRefresh:u}}({itemSearchDocument:d,queryParams:m,matrixParams:b}),g=x.collectionListType,y=void 0===g?{}:g,C=x.onRefresh,S=x.isLoading,w=y.collection,P=void 0===w?[]:w,k=y.hits,D=void 0===k?0:k,R=function(){a(),C()},E=function(e){var a=t.filter((function(t){return t!==e}));a.length!==t.length?n(a):n([].concat(Object(ie.a)(a),[e]))},A=function(){var e=Object(zn.a)(Wn.a.mark((function e(t){var n,a,i,c,s;return Wn.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.dragInfo,a=t.dropInfo,i=n.entityId,c=n.entityParentId,s=a.entityId){e.next=9;break}return e.next=6,r({Dialog:it});case 6:if(s=e.sent){e.next=9;break}return e.abrupt("return");case 9:se(i,s,c).then((function(){return o({open:!0,message:"Success!"})})).catch((function(e){return e.message&&o({open:!0,message:"Success!"})})).then(R);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(V.jsxs)(T.a,{container:!0,spacing:2,children:[Object(V.jsx)(T.a,{item:!0,xs:12,children:Object(V.jsx)(u.a,{height:50,display:"flex",alignItems:"center",children:Object(V.jsx)(c.E,{onSubmit:p,searchPlaceholder:"Search collections...",InputBaseProps:{style:{flexGrow:1}}})})}),Object(V.jsx)(T.a,{item:!0,xs:12,children:Object(V.jsx)(I.a,{variant:"h6",children:"Filter by collection"})}),P.map((function(e){return Object(V.jsx)(T.a,{item:!0,xs:12,children:Object(V.jsx)(Xn,{onDrop:A,onClick:E,checked:t.includes(e.id),collectionType:e})},e.id)})),P.length<D&&Object(V.jsx)(T.a,{item:!0,xs:12,children:Object(V.jsx)(O.a,{startIcon:S?Object(V.jsx)(Ne.a,{size:20}):Object(V.jsx)(Gn.a,{fontSize:"small"}),disabled:P.length===D,onClick:function(){return f({target:{value:v+5}})},children:"Load more..."})}),Object(V.jsx)(T.a,{item:!0,xs:12,children:Object(V.jsx)($n,{startIcon:Object(V.jsx)(Hn.a,{fontSize:"small"}),onClick:function(){return r({Dialog:it}).then(R).catch((function(){return null}))},onDrop:A,children:"Create collection"})})]})},ea=n(116),ta=n(14),na=n(603),aa=n(604),ra=n(605),ia=Object(j.l)(Object(p.a)((function(e){return{root:{boxShadow:e.shadows[1],transition:"box-shadow 0.3s ease",cursor:"grab","&:hover":{boxShadow:e.shadows[5]},"& .card-content":{backgroundColor:Object(ta.c)(e.palette.background.paper,.1)},"& .card-thumbnail":{cursor:"grab !important"}},isDragging:{opacity:.3,cursor:"grabbing"}}})),c.Q)(c.y),oa=function(e){return Object(V.jsx)(ia,Object(h.a)({},e))},ca=function(e){var t=e.itemId,n=e.onOpen,a=e.onMerge,r=e.onDelete,i=e.onRename,o=e.onAddToCollection;return Object(V.jsxs)(It,{onOpen:n,size:"small",children:[Object(V.jsxs)(g.a,{component:v.b,to:"/training/".concat(t),children:[Object(V.jsx)(Tt.a,{children:Object(V.jsx)(na.a,{fontSize:"small"})}),Object(V.jsx)(St.a,{primary:"Go to face"})]}),Object(V.jsxs)(g.a,{onClick:i,children:[Object(V.jsx)(Tt.a,{children:Object(V.jsx)(aa.a,{fontSize:"small"})}),Object(V.jsx)(St.a,{primary:"Change name"})]}),Object(V.jsxs)(g.a,{onClick:o,children:[Object(V.jsx)(Tt.a,{children:Object(V.jsx)(ae.a,{fontSize:"small"})}),Object(V.jsx)(St.a,{primary:"Move to collection"})]}),Object(V.jsxs)(g.a,{onClick:a,children:[Object(V.jsx)(Tt.a,{children:Object(V.jsx)(ra.a,{fontSize:"small"})}),Object(V.jsx)(St.a,{primary:"Map to existing face"})]}),Object(V.jsx)(wt.a,{}),Object(V.jsxs)(g.a,{onClick:r,children:[Object(V.jsx)(Tt.a,{children:Object(V.jsx)(At.a,{fontSize:"small"})}),Object(V.jsx)(St.a,{primaryTypographyProps:{color:"error"},primary:"Delete face"})]})]})},sa=function(e){var t=e.title,n=e.itemId,a=e.method,r=e.interactive,i=e.onOpen,o=e.onMerge,c=e.onDelete,s=e.onRename,l=e.onAddToCollection,d="INDEXED"===a,j="TRAINED"===a;return Object(V.jsxs)(u.a,{className:"card-content",display:"flex",flexDirection:"row",p:1,alignItems:"center",children:[Object(V.jsxs)(u.a,{flexGrow:1,display:"flex",flexDirection:"column",overflow:"hidden",children:[Object(V.jsx)(I.a,{noWrap:!0,style:{flexGrow:1},variant:"subtitle1",children:t&&t}),d&&Object(V.jsx)(u.a,{color:"info.dark",children:Object(V.jsx)(I.a,{color:"inherit",variant:"button",children:"system trained"})}),j&&Object(V.jsx)(u.a,{color:"success.dark",children:Object(V.jsx)(I.a,{variant:"button",children:"user trained"})}),!j&&!d&&Object(V.jsx)(u.a,{color:"warning.dark",children:Object(V.jsx)(I.a,{variant:"button",children:"not trained"})})]}),Object(V.jsx)(u.a,{flexShrink:0,flexBasis:1,children:r&&Object(V.jsx)(ca,{itemId:n,onOpen:i,onMerge:o,onDelete:c,onRename:s,onAddToCollection:l})})]})},la=function(e){var t=e.title,n=e.subheader,a=e.content,r=e.avatar,i=e.itemId,o=e.onOpen,c=e.onClick,s=e.onMerge,l=e.onDelete,u=e.onRename,d=e.onAddToCollection,j=e.interactive,m=void 0===j||j,b=Object(le.a)(e,["title","subheader","content","avatar","itemId","onOpen","onClick","onMerge","onDelete","onRename","onAddToCollection","interactive"]);return Object(V.jsx)(oa,Object(h.a)(Object(h.a)({},b),{},{CardProps:{style:{width:200},onClick:function(){return c({itemId:i,title:t,parentId:a,method:n})}},ThumbnailProps:{className:"card-thumbnail"},HeaderComponent:null,ActionsComponent:null,ContentComponent:sa,ContentProps:{title:t,itemId:i,method:r,subheader:n,interactive:m,onOpen:function(){return o({itemId:i,parentId:a,title:t,method:r})},onMerge:s,onDelete:l,onRename:u,onAddToCollection:d},parentId:a,hideDefaultDraggedComponent:!1}))},ua=n(613),da=n(383),ja=n(609),ma=n(606),ba=n(607),ha=n(608),va={content:"shape",methodMetadata:[{key:"format",value:"SIGNED-AUTO"},{key:"contentDisposition",value:"attachment"}],"noauth-url":!0},pa=function(e){var t=e.onOpen,n=e.onClose,a=e.onMove,r=e.onDelete,i=e.onThumbnail;return Object(V.jsxs)(It,{size:"small",onOpen:t,onClose:n,style:{color:"#fff"},children:[Object(V.jsxs)(g.a,{onClick:a,children:[Object(V.jsx)(Tt.a,{children:Object(V.jsx)(na.a,{})}),Object(V.jsx)(St.a,{primary:"Move resource"})]}),Object(V.jsxs)(g.a,{onClick:i,children:[Object(V.jsx)(Tt.a,{children:Object(V.jsx)(Et.a,{})}),Object(V.jsx)(St.a,{primary:"Use as thumbnail"})]}),Object(V.jsxs)(g.a,{onClick:r,children:[Object(V.jsx)(Tt.a,{children:Object(V.jsx)(At.a,{})}),Object(V.jsx)(St.a,{primary:"Delete resource"})]})]})},fa=Object(p.a)((function(e){return{root:{zIndex:10,padding:e.spacing(1),height:"auto"},titleWrap:{margin:0}}}))(ma.a),Oa=function(e){var t=e.resource,n=e.onMove,a=e.onDelete,i=t.uri,o=t.shapeId,s=t.metadata,l=r.a.useMemo((function(){if(!s)return"NOT TRAINED";var e=s.vcs_face_method;return"INDEXED"===e?"SYSTEM TRAINED":"TRAINED"===e?"USER TRAINED":"NOT TRAINED"}),[s]);return Object(V.jsxs)(V.Fragment,{children:[Object(V.jsx)(c.B,{image:i,height:200}),Object(V.jsx)(fa,{title:l,actionIcon:Object(V.jsx)(pa,{shapeId:o,onMove:function(){return n(o)},onDelete:function(){return a(o)}})})]})},xa=Object(p.a)((function(e){var t=e.palette;return{tile:{backgroundColor:t.background.paper,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transition:"all .2s","&:hover":{backgroundColor:t.primary.main}}}}))(ba.a),ga=function(e){var t=e.itemType,n=e.onRefresh,a=e.cols,i=void 0===a?2:a,o=be().showDialog,c=Ce().setNotification,s=function(){return c({open:!0,message:"Success!"})},l=function(e){var t=e.message;return t&&c({open:!0,message:t,severity:"error"})},u=t.shape,d=void 0===u?[]:u,j=t.id,m=r.a.useMemo((function(){return d.map((function(e){return Object(h.a)(Object(h.a)({},function(e){if(!e)return{};var t={},n=e.id,a=e.metadata,r=Object(le.a)(e,["id","metadata"]),i=r.containerComponent,o=(i=void 0===i?{}:i).file,c=void 0===o?[]:o;if(c.length){var s=Object(J.a)(c,1)[0],l=s.id,u=s.storage;l&&(t.fileId=l),u&&(t.storageId=u)}if(a){var d=a.field,j=void 0===d?[]:d;j.length&&(t.metadata=Object(re.e)(j))}return Object(h.a)(Object(h.a)(Object(h.a)({},Object(re.g)(r,{flat:!0})),t),{},{shapeId:n})}(e)),{},{itemId:j})}))}),[d,j]),b=function(e){return o({title:"Delete resource",message:"Are you sure you want to delete this resource?",okText:"Yes, delete",noText:"No, cancel"}).then((function(){return function(e,t){return K.q.removeShape({itemId:e,shapeId:t})}(j,e).then(s).catch(l)})).catch(l).then(n)},v=function(e){return o({Dialog:st,itemId:j,shapeId:e}).then(s).catch(l).then(n)};return Object(V.jsxs)(ha.a,{cellHeight:200,cols:i,spacing:8,children:[m.map((function(e){return Object(V.jsx)(ba.a,{cols:1,children:Object(V.jsx)(Oa,{resource:e,onMove:v,onDelete:b})},e.shapeId)})),Object(V.jsxs)(xa,{onClick:function(){return o({Dialog:Re,itemId:j}).then((function(){return c({open:!0,message:"Import job started"})})).catch(l)},cols:1,children:[Object(V.jsx)(Hn.a,{size:"large"}),Object(V.jsx)(I.a,{variant:"button",children:"Add new resource"})]})]})},ya=function(e){var t=e.itemId,n=e.cols,a=void 0===n?2:n;return t?Object(V.jsx)(j.e,{itemId:t,queryParams:va,children:Object(V.jsx)(ga,{cols:a})}):null},Ca=n(64),Ia=n(38);var Ta=[{field:["adu_av_value","adu_av_valueId"],name:"adu_face_DeepVAKeyframeAnalyzer",label:"Recognized faces"}],Sa=[{name:"adu_av_value",label:"Name"},{name:"adu_av_valueId",label:"ID"}],wa=Object(p.a)((function(e){var t=e.spacing;return{root:{height:t(4),width:t(4)}}}))((function(e){var t=e.itemType,n=e.timespan,a=e.classes,r=Object(re.b)(t,n.start||0),i=Object(re.c)(n.start);return Object(V.jsx)(Gt.a,{title:i.toSmpte(),arrow:!0,placement:"right",children:Object(V.jsx)(xn.a,{classes:a,component:v.b,to:"/item/".concat(t.id,"?t=").concat(i.toSeconds()),variant:"rounded",src:r})})})),Pa=function(e){var t=e.itemType,n=void 0===t?{}:t,a=r.a.useMemo((function(){return function(e){var t=Object(re.f)(e.metadata,{flat:!0,arrayOnSingle:!1}).vcs_face_externalId;return t?{itemSearchDocument:{filter:[{name:"id_filter",operation:"OR",field:[{name:"adu_av_valueId",value:[{value:t}]}]}],intervals:"all",text:[{value:t}]},queryParams:{field:["originalFilename","durationSeconds","itemId","title","adu_value","adu_av_value","adu_av_valueId","adu_av_confidence"],content:["metadata","thumbnail"],"noauth-url":!0,interval:"all"}}:{queryParams:{number:0}}}(n)}),[n]),i=Object(j.A)(a).state,o=i.itemSearchDocument,s=void 0===o?{}:o,l=i.queryParams,u=i.matrixParams,d=Object(j.B)({itemSearchDocument:s,queryParams:l,matrixParams:u}).itemListType,m=(d=void 0===d?{}:d).item,b=void 0===m?[]:m;return Object(V.jsx)(Ca.a,{children:b.map((function(e,t){var n=e.metadata.timespan.filter((function(e){var t=e.start,n=e.end;return"-INF"===t&&"+INF"===n})),a=Object(J.a)(n,1)[0],r=Object(re.h)(a,{flat:!0,arrayOnSingle:!1}).title;return Object(V.jsx)(Ia.a,{divider:t+1!==b.length,children:Object(V.jsx)(St.a,{disableTypography:!0,primary:Object(V.jsx)(I.a,{style:{marginBottom:30},variant:"h6",children:r}),secondary:Object(V.jsx)(c.j,{itemType:e,itemSearchDocument:s,GroupConfig:Ta,FieldLabelMap:Sa,EventMarkerThumbnailComponent:wa,EventContainerComponent:!1,EventComponent:!1,EventListComponent:!1,EventContentComponent:!1},e.id)})},e.id)}))})},ka={content:"metadata",field:"vcs_face_externalId"},Da=function(e){var t=e.isLoading,n=Object(le.a)(e,["isLoading"]);return t?null:Object(V.jsx)(Pa,Object(h.a)({},n))},Ra=function(e){var t=e.itemId;return Object(V.jsx)(j.e,{itemId:t,queryParams:ka,children:Object(V.jsx)(Da,{})})},Ea=Object(j.l)(Object(p.a)((function(e){return{root:{flexShrink:0,"&.open":{width:400},"& > *":{transition:"all 0.3s ease"}},paper:{zIndex:e.zIndex.appBar-1,flexShrink:0,width:400,overflow:"auto"},canDrop:{"& > *":{border:"1px solid ".concat(e.palette.primary.main)}},isOver:{"& > *":{backgroundColor:e.palette.primary.main}}}})),c.R)(ua.a),Aa=function(e){var t=e.itemId,n=Object(le.a)(e,["itemId"]),a=[{label:"images",component:ya},{label:"appearances",component:Ra}];return Object(V.jsx)(c.s,Object(h.a)({tabs:a,itemId:t},n))},La=function(e){var t=e.open,n=e.onDrop,a=e.onClose,i=e.item,o=void 0===i?{}:i,c=o.itemId,s=o.title,l=o.parentId,d=Object(j.q)(K.i.getItem),m=d.request,b=d.data,v=void 0===b?{}:b,p=d.isLoading;r.a.useEffect((function(){if(c){m({itemId:c,queryParams:{content:"shape",p:"shape.metadata.field[key=vcs_face_method]"}})}}),[c,m]);var f=r.a.useMemo((function(){var e=v.shape,t=void 0===e?[]:e;return!!t.length&&t.reduce((function(e,t){var n=t.metadata,a=(void 0===n?{}:n).field,r=((void 0===a?[]:a).find((function(e){return"vcs_face_method"===e.key}))||{}).value;return"TRAINED"!==r&&"INDEXED"!==r?Object(h.a)(Object(h.a)({},e),{},{needsTraining:!0}):e}),{needsTraining:!1})}),[v]).needsTraining;return Object(V.jsxs)(Ea,{className:t?"open":void 0,open:t,onClose:function(){return a(void 0)},anchor:"right",variant:"persistent",onDrop:n,children:[Object(V.jsx)(da.a,{}),Object(V.jsxs)(u.a,{p:1,children:[Object(V.jsx)(Pt.a,{elevation:0,style:{backgroundColor:"inherit"},children:Object(V.jsx)(kt.a,{title:s,subheader:Object(V.jsxs)(V.Fragment,{children:[p&&Object(V.jsx)(Ne.a,{}),!p&&f&&Object(V.jsxs)(u.a,{mt:1,display:"flex",alignItems:"flex-start",flexGrow:1,color:"#f44336",children:[Object(V.jsx)(ja.a,{}),Object(V.jsx)(I.a,{style:{marginLeft:8},variant:"body2",children:"This resource needs to be trained."})]})]}),titleTypographyProps:{variant:"h4"},action:Object(V.jsx)(Ot.a,{onClick:function(){return a(void 0)},children:Object(V.jsx)(_t.a,{})})})}),c&&Object(V.jsx)(Aa,{itemId:c,parentId:l})]})]})},_a=function(e){var t=e.checked;return Object(V.jsx)(kn.a,{checked:t})},Na=Object(p.a)((function(e){var t=e.shadows,n=e.palette,a=e.spacing;return{root:{marginBottom:a(2),cursor:"pointer",boxShadow:t[1],transition:"all 0.3s ease","& .MuiCardHeader-root":{paddingRight:a(1),transition:"all 0.3s ease"},"& .MuiCardHeader-action":{alignSelf:"unset"},"& .MuiIconButton-root":{transition:"all 0.3s ease"},"&:hover":{"& .MuiIconButton-root":{color:n.secondary.main}},"&:not(:last-child)":{marginRight:a(2)}}}}))((function(e){var t=e.onClick,n=Object(le.a)(e,["onClick"]);return Object(V.jsx)(c.y,Object(h.a)({ThumbnailComponent:null,ContentComponent:null,ActionsComponent:null,MenuComponent:null,AvatarComponent:_a,CardProps:{onClick:t}},n))})),Fa="status_filter",Ma="vcs_face_method",Ua={name:"status_filter",operation:"AND",field:[{name:Ma,value:[{value:"TRAINED"}]}]},Va={name:"status_filter",operation:"AND",field:[{name:Ma,value:[{value:"INDEXED"}]}]},qa={name:"status_filter",operation:"NOT",field:[{name:Ma,value:[{value:"*"}]}]},Ba=function(e){var t=e.filter,n=void 0===t?{}:t,a=e.setFilter,i=r.a.useMemo((function(){var e=n.filter,t=(void 0===e?[]:e).find((function(e){return e.name===Fa}))||{},a=t.operation,r=t.field,i=void 0===r?[{}]:r;if("NOT"===a)return[!1,!1,!0];var o=Object(J.a)(i,1)[0].value;o=void 0===o?[{}]:o;var c=Object(J.a)(o,1)[0].value;return"TRAINED"===c?[!1,!0,!1]:"INDEXED"===c?[!0,!1,!1]:[!1,!1,!1]}),[n]),o=Object(J.a)(i,3),c=o[0],s=o[1],l=o[2];return Object(V.jsxs)(u.a,{display:"flex",flexDirection:"column",children:[Object(V.jsx)(I.a,{paragraph:!0,gutterBottom:!0,variant:"h6",children:"Filter by state"}),Object(V.jsxs)(u.a,{display:"flex",flexWrap:"wrap",children:[Object(V.jsx)(Na,{checked:s,onClick:function(){var e=n.filter,t=(void 0===e?[]:e).filter((function(e){return e.name!==Fa}));a(s?Object(h.a)(Object(h.a)({},n),{},{filter:t}):Object(h.a)(Object(h.a)({},n),{},{filter:[].concat(Object(ie.a)(t),[Ua])}))},title:"User trained",subheader:"Display only faces trained manually"}),Object(V.jsx)(Na,{checked:c,onClick:function(){var e=n.filter,t=(void 0===e?[]:e).filter((function(e){return e.name!==Fa}));a(c?Object(h.a)(Object(h.a)({},n),{},{filter:t}):Object(h.a)(Object(h.a)({},n),{},{filter:[].concat(Object(ie.a)(t),[Va])}))},title:"System trained",subheader:"Display only faces trained by the system"}),Object(V.jsx)(Na,{checked:l,onClick:function(){var e=n.filter,t=(void 0===e?[]:e).filter((function(e){return e.name!==Fa}));a(l?Object(h.a)(Object(h.a)({},n),{},{filter:t}):Object(h.a)(Object(h.a)({},n),{},{filter:[].concat(Object(ie.a)(t),[qa])}))},title:"Not trained",subheader:"Display only faces not trained"})]})]})},Wa=["FAILED_TOTAL","ABORTED"],za=["FINISHED","FINISHED_WARNING"],Ga=function(e){var t=e.itemListType,n=e.onRefresh,a=e.state,i=be().showDialog,o=Ce().setNotification,s=a.state,l=(s=void 0===s?{}:s).page,d=s.searchText,m=void 0===d?"":d,h=s.rowsPerPage,v=s.itemSearchDocument,p=a.onChangePage,f=a.setSearchText,x=a.onChangeRowsPerPage,g=a.setItemSearchDocument,y=t.item,C=void 0===y?[]:y,I=t.hits,S=void 0===I?0:I,w=t.isLoading,P=Object(j.r)({field:A}),k=P.suggestions,D=P.setAutocompleteText,R=r.a.useRef(b()(D,200)).current;r.a.useEffect((function(){return R(m)}),[m,R]);var E=r.a.useCallback((function(){return o({open:!0,message:"Success!"})}),[o]),L=r.a.useCallback((function(e){if(e){var t=e.message;t&&o({open:!0,message:t,severity:"error"})}}),[o]),_=r.a.useCallback((function(e){var t=e.data,a=(t=void 0===t?{}:t).jobId,r=function(){var e=Object(zn.a)(Wn.a.mark((function e(){var t,a,i;return Wn.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,K.j.getJob({jobId:"VX-121"});case 2:t=e.sent,a=t.data,i=(void 0===a?{}:a).status,za.includes(i)?(E(),n()):Wa.includes(i)?L(new Error("Job failed")):setTimeout(r,250);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();a?r():L(new Error("Failed to start job"))}),[n,E,L]),N=r.a.useState(void 0),F=Object(J.a)(N,2),M=F[0],U=F[1],q=r.a.useState(void 0),B=Object(J.a)(q,2),W=B[0],z=B[1],G=r.a.useState(!0),H=Object(J.a)(G,2),Q=H[0],X=H[1];return Object(V.jsxs)(u.a,{display:"flex",children:[Object(V.jsxs)(T.a,{container:!0,spacing:2,children:[Object(V.jsx)(T.a,{item:!0,xs:12,children:Object(V.jsxs)(u.a,{height:50,display:"flex",alignItems:"center",children:[Object(V.jsx)(c.E,{submitting:w,searchPlaceholder:"Search faces...",InputBaseProps:{style:{flexGrow:1}},value:m,onChange:f,SuggestionsComponent:c.F,SuggestionsProps:{suggestions:k}}),Object(V.jsxs)(O.a,{variant:"contained",color:"primary",style:{flexShrink:0,marginLeft:16},onClick:function(){return X(!Q)},children:[Q?"Hide":"Show"," filter"]}),Object(V.jsx)(c.D,{page:l,count:S,rowsPerPage:h,onChangePage:p,onChangeRowsPerPage:x,TablePaginationProps:{style:{flexShrink:0},labelRowsPerPage:"Items per page"}})]})}),Object(V.jsxs)(T.a,{item:!0,xs:12,children:[Object(V.jsx)(ea.a,{in:Q,children:Object(V.jsx)(Ba,{filter:v,setFilter:g})}),Object(V.jsx)(c.m,{itemList:C,itemListType:t,GridContainerProps:{spacing:2},ItemCardProps:{MediaCardComponent:la,onOpen:function(e){return U(e)},onClick:function(e){return z(e)},onMerge:function(){return i({Dialog:ze,item:M}).then(_).catch(L)},onDelete:function(){return i({title:"Delete resource",message:"Are you sure you would like to delete this resource?",okText:"Yes, delete item",noText:"No, cancel"}).then((function(){return(e=M.itemId,K.i.removeItem({itemId:e})).then(E).catch(L);var e})).catch(L).then(n)},onRename:function(){return i({Dialog:lt,item:M}).then(_).catch(L)},onAddToCollection:function(){return i({Dialog:De,item:M}).then(E).catch(L).then(n)},titleSelector:function(e){var t=e.title,n=e.filename;return t||n},contentSelector:function(e){return e.parentId},subheaderSelector:function(e){return e.created},avatarSelector:function(e){return e.method}}})]})]}),Object(V.jsx)(La,{open:Boolean(W),item:W,onClose:z,onDrop:function(e){var t=e.dragInfo;return i({title:"Merge resources",message:"Are you sure you would like to merge these resources?",okText:"Yes, merge items",noText:"No, cancel"}).then((function(){return oe(t.entityId,W.itemId).then(_).catch(L)})).catch(L)}})]})},Ha={itemSearchDocument:{filter:[{name:"training_material",operation:"AND",field:[{name:E,value:[{value:!0}]}]}]},queryParams:{field:["".concat(A,":title"),"".concat(L,":method"),"created","originalFilename:filename","title:backupTitle","__collection:parentId"],content:["metadata","thumbnail"],methodMetadata:[{key:"format",value:"SIGNED-AUTO"}],"noauth-url":!0},rowsPerPage:10},Ja=function(){var e=r.a.useState([]),t=Object(J.a)(e,2),n=t[0],a=t[1],i=Object(j.A)(Ha),o=i.state,c=Object(le.a)(i,["state"]),s=o.itemSearchDocument,l=Object(j.B)(o),u=l.itemListType,d=void 0===u?{}:u,m=l.onRefresh;return r.a.useEffect((function(){var e=c.onChangePage,t=c.setSearchText,a=c.setItemSearchDocument,r=n.map((function(e){return{value:e}}));e({page:0}),t(""),r.length?a(Object(h.a)(Object(h.a)({},s),{},{operator:{field:[{name:"__parent_collection",value:r},{name:"__collection",value:r}],operation:"OR"}})):a(Object(h.a)(Object(h.a)({},s),{},{operator:void 0}))}),[n]),Object(V.jsxs)(T.a,{container:!0,spacing:2,alignItems:"flex-start",children:[Object(V.jsx)(T.a,{item:!0,xs:12,sm:12,md:4,lg:3,xl:2,children:Object(V.jsx)(Zn,{collectionId:n,setCollectionId:a,onRefresh:m})}),Object(V.jsx)(T.a,{container:!0,item:!0,xs:12,sm:12,md:8,lg:9,xl:10,children:Object(V.jsx)(Ga,{itemListType:d,onRefresh:m,state:Object(h.a)({state:o},c)})})]})},Ka=function(){return Pe().isLoading?Object(V.jsx)(Ne.a,{}):Object(V.jsx)(Ja,{})},Qa=Object(p.a)({content:{overflow:"hidden"},avatar:{"& .MuiAvatar-root":{width:100,height:100}}})(kt.a),Xa=function(e){var t=e.itemType,n=void 0===t?{}:t,a=Object(s.a)().t,i=r.a.useMemo((function(){return Object(re.f)(n.metadata,{flat:!0,arrayOnSingle:!1})}),[n]),o=i[A],c=i.user,l=i.created;return Object(V.jsx)(Qa,{title:o,style:{overflow:"hidden"},titleTypographyProps:{variant:"h3",noWrap:!0},subheader:Object(V.jsxs)(u.a,{display:"flex",alignItems:"center",children:[Object(V.jsxs)(I.a,{variant:"body1",children:[a("createdBy"),"\xa0"]}),Object(V.jsx)(I.a,{variant:"subtitle1",children:c}),Object(V.jsx)(I.a,{variant:"body1",children:"\xa0on\xa0"}),Object(V.jsx)(I.a,{variant:"subtitle1",children:l?Ae()(l).format("ll"):""})]}),avatar:Object(V.jsx)(xn.a,{variant:"rounded",alt:o})})},Ya=function(e){var t=e.itemId,n=Object(le.a)(e,["itemId"]),a=[{label:"images",component:ya,cols:4},{label:"appearances",component:Ra}];return Object(V.jsx)(c.s,Object(h.a)({tabs:a,itemId:t},n))},$a=function(){var e=Object(d.i)().itemId;return Object(V.jsxs)(T.a,{container:!0,children:[Object(V.jsx)(T.a,{item:!0,xs:12,sm:6,children:Object(V.jsx)(j.e,{itemId:e,queryParams:{content:["metadata"],interval:"generic"},children:Object(V.jsx)(Xa,{})})}),Object(V.jsx)(T.a,{item:!0,xs:12,sm:6,children:Object(V.jsx)(Ya,{itemId:e})})]})},Za=b()((function(e){window.localStorage.setItem("bin",JSON.stringify(e))}),500),er=JSON.parse(window.localStorage.getItem("bin")||JSON.stringify([]));var tr=function(e){var t,n=e.username,a=e.onLogout,r=e.serverUrl,i=e.onLogin;return Object(V.jsxs)(j.c,{providers:[we,{provider:ve,resourceType:"vidinet"},ye,{provider:j.b,initialState:er,onChange:Za},j.h,c.f,{provider:Te,uploadProps:{onUploadFile:et,initialMetadata:(t={},Object(l.a)(t,E,!1),Object(l.a)(t,A,""),t),chunkedUploadProps:{chunkSize:2e8,minChunkSize:1e7,maxConcurrentTransfers:10,minFileSize:1e8,maxConcurrentFileTransfers:1}}},me],children:[Object(V.jsxs)(u.a,{height:"100vh",children:[Object(V.jsx)(ft,{userName:n,onLogout:a,serverUrl:r,onLogin:i}),Object(V.jsx)(u.a,{mb:7.5,p:2,children:Object(V.jsxs)(d.d,{children:[Object(V.jsx)(d.b,{path:"/import",children:Object(V.jsx)(qn,{})}),Object(V.jsx)(d.b,{path:"/item/:itemId",children:Object(V.jsx)(an,{})}),Object(V.jsx)(d.b,{path:"/item/",children:Object(V.jsx)(Mn,{})}),Object(V.jsx)(d.b,{path:"/training/:itemId",children:Object(V.jsx)($a,{})}),Object(V.jsx)(d.b,{path:"/training/",children:Object(V.jsx)(Ka,{})}),Object(V.jsx)(d.a,{from:"/",push:!0,to:"/item/"})]})})]}),Object(V.jsx)(c.u,{})]})},nr=n(610),ar=new URLSearchParams(window.location.search).get("to")||"";function rr(e){var t=e.onLogin,n=e.userName,a=e.serverUrl,r=void 0===a?ar:a,i=e.onBack,o=e.AppTitleComponent,l=Object(s.a)().t;return Object(V.jsxs)(nr.a,{maxWidth:"sm",children:[Object(V.jsx)("div",{style:{height:"30vh"}}),Object(V.jsxs)(T.a,{container:!0,justifyContent:"space-between",alignItems:"center",direction:"row",style:{width:"100%"},children:[Object(V.jsx)(T.a,{item:!0,children:Object(V.jsx)(o,{subheader:r})}),i&&Object(V.jsx)(T.a,{item:!0,children:Object(V.jsx)(O.a,{onClick:i,size:"small",variant:"outlined",children:l("Back To Server List")})})]}),Object(V.jsx)(c.w,{onSubmit:t,FormProps:{initialValues:{userName:n,serverUrl:r}},FormFieldsProps:{UrlFieldComponent:r?null:void 0,RememberMeFieldComponent:null},FormButtonsProps:{SubmitButtonProps:{variant:"outlined",color:"primary"}}})]})}var ir=n(92),or=n(63),cr=n.n(or),sr=n(163),lr=n.n(sr),ur=n(372),dr=n.n(ur),jr=n(373),mr=n.n(jr),br=n(153);function hr(e){var t=e.onClickServer,n=e.serverList,a=void 0===n?[]:n,i=e.onAddServer,o=e.onRemoveServer,c=e.AppTitleComponent,s=r.a.useState(),l=Object(J.a)(s,2),u=l[0],d=l[1],j=r.a.useState(0===a.length),m=Object(J.a)(j,2),b=m[0],h=m[1],v=r.a.useState(),p=Object(J.a)(v,2),f=p[0],O=p[1],x=r.a.useState(""),g=Object(J.a)(x,2),y=g[0],C=g[1],I=function(e){e&&e.preventDefault&&e.preventDefault();var t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Not a URL",n=new RegExp(/https?:\/\/[-a-zA-Z0-9@:%._+~#=]{2,256}\b([-a-zA-Z0-9@:%_+.~#?&//=]*)/gi);return e.match(n)?void 0:t}(y);t?O(t):(i(y),h(!1),C(""),O())};r.a.useEffect((function(){Promise.all(a.map((function(e){return new Promise((function(t){return K.n.getSelfTest({baseURL:e}).then((function(){return t(!0)})).catch((function(){return t(!1)}))}))}))).then((function(e){return d(e)}))}),[a]);return Object(V.jsxs)(nr.a,{maxWidth:"sm",children:[Object(V.jsx)("div",{style:{height:"30vh"}}),Object(V.jsxs)(T.a,{container:!0,justifyContent:"space-between",direction:"row",style:{width:"100%"},children:[c&&Object(V.jsx)(T.a,{item:!0,children:Object(V.jsx)(c,{})}),Object(V.jsx)(T.a,{item:!0,children:Object(V.jsx)(jt.a,{control:Object(V.jsx)(Un.a,{checked:b,onChange:function(e){return h(e.target.checked)}}),label:"Edit"})})]}),Object(V.jsxs)(Ca.a,{component:"nav",children:[b&&Object(V.jsx)(Ia.a,{children:Object(V.jsx)("form",{onSubmit:I,style:{width:"100%"},children:Object(V.jsx)(Q.a,{value:y,onChange:function(e){C(e.target.value)},label:"Add Server",variant:"outlined",fullWidth:!0,error:void 0!==f,helperText:f,InputProps:{endAdornment:Object(V.jsx)(Pn.a,{position:"end",children:Object(V.jsx)(Ot.a,{onClick:I,children:Object(V.jsx)(lr.a,{})})})}})})}),a.map((function(e,n){return Object(V.jsxs)(Ia.a,{button:!b,onClick:b?void 0:function(){return t(e)},children:[Object(V.jsx)(St.a,{primary:e}),Object(V.jsx)(ir.a,{children:b?Object(V.jsx)(Ot.a,{edge:"end",onClick:function(){return o(e)},children:Object(V.jsx)(cr.a,{})}):Array.isArray(u)&&(!0===u[n]?Object(V.jsx)(dr.a,{style:{color:br.a[500]}}):Object(V.jsx)(mr.a,{color:"error"}))})]},e)}))]})]})}var vr=n(374),pr=n(375),fr=n(114),Or=n(381),xr=n(379),gr=n(175),yr=n(611),Cr="https://vidispine.github.io/face-training-theme",Ir=Cr;if(Ir.startsWith("http")){var Tr=new URL(Ir);Ir=Tr.pathname}var Sr={maxAge:604800,path:Ir,sameSite:"strict"},wr="VIDISPINE-SERVERS",Pr="VIDISPINE-TOKEN",kr=function(e){Object(Or.a)(n,e);var t=Object(xr.a)(n);function n(e){var a;Object(vr.a)(this,n),(a=t.call(this,e)).onChangeServer=a.onChangeServer.bind(Object(fr.a)(a)),a.onAddServer=a.onAddServer.bind(Object(fr.a)(a)),a.onRemoveServer=a.onRemoveServer.bind(Object(fr.a)(a)),a.onUpdateCookie=a.onUpdateCookie.bind(Object(fr.a)(a)),a.onLogin=a.onLogin.bind(Object(fr.a)(a)),a.onLogout=a.onLogout.bind(Object(fr.a)(a));var r=e.cookies,i=r.get(wr),o=r.get(Pr),c=function(e){if(e){var t=atob(e);return JSON.parse(t)}}(i),s=window.location.pathname,l=function(e){var t=Object(gr.a)("/:basename/server/:serverUrl/:any*").exec(e);if(t||(t=Object(gr.a)("/:basename/server/:serverUrl",[],{strict:!0}).exec(e)),t||(t=Object(gr.a)("/server/:serverUrl/:any*").exec(e)),t)try{var n=t[2];return decodeURIComponent(n)}catch(a){if(a instanceof URIError)return;throw a}}(s);if(a.state={servers:c,token:o},e.serverUrl&&l!==e.serverUrl){var u={serverUrl:e.serverUrl,userName:""};a.state.apiServer=u,a.state.servers=[u]}else if(l)if(c){var d=c.find((function(e){return e.serverUrl===l}));d?a.state.apiServer=d:(a.state.apiServer={serverUrl:l},a.state.token=void 0)}else a.state.apiServer={serverUrl:l},a.state.token=void 0;else!function(e){var t=Object(gr.a)("/:basename/server/(.*)",[],{strict:!0}).exec(e);if(t&&t[2])try{var n=new URL(t[2]).origin;if(!n)return;var a=encodeURIComponent(n),r=e.replace(n,a);window.history.pushState({},document.title,r),window.location.reload()}catch(i){}}(s);return a}return Object(pr.a)(n,[{key:"onChangeServer",value:function(e){var t=Ir;e&&(t="".concat(Cr.replace(/\/+$/,""),"/server/").concat(encodeURIComponent(e),"/")),window.history.pushState({},document.title,t);var n=this.state.servers,a=(void 0===n?[]:n).find((function(t){return t.serverUrl===e}))||{};a.hasToken?window.location.reload():this.setState({apiServer:a})}},{key:"onAddServer",value:function(e){var t=e.replace(/^(.+?)\/*?$/,"$1"),n=this.state.servers,a=void 0===n?[]:n,r=[{serverUrl:t}].concat(Object(ie.a)(a));this.setState({servers:r}),this.onUpdateCookie(r)}},{key:"onRemoveServer",value:function(e){var t=this.state.servers,n=(void 0===t?[]:t).filter((function(t){return t.serverUrl!==e}));this.setState({servers:n}),this.onUpdateCookie(n)}},{key:"onUpdateCookie",value:function(e){var t=this.props.cookies,n=function(e){if(e){var t=JSON.stringify(e);return btoa(t)}}(e);t.set(wr,n,Sr)}},{key:"onLogin",value:function(e,t){var n=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){return null},r=e.userName,i=e.password,o=e.serverUrl;a(),r&&i&&o?K.w.getToken({userName:r,queryParams:{seconds:2592e3,autoRefresh:"true"},headers:{password:i,username:r},baseURL:o}).then((function(e){var t=e.data,a={serverUrl:o,userName:r,hasToken:!0},i=n.props,c=i.cookies,s=i.serverUrl;c.set(Pr,t,Object(h.a)(Object(h.a)({},Sr),{},{path:s?"/":"".concat(Ir.replace(/\/+$/,""),"/server/").concat(encodeURIComponent(o))}));var l=n.state.servers,u=void 0===l?[]:l,d=Object(ie.a)(u),j=d.findIndex((function(e){return e.serverUrl===o}));if(j>-1){var m=d[j];d[j]=Object(h.a)(Object(h.a)({},m),a)}else d.push(a);n.onUpdateCookie(d),n.setState({token:t,servers:d,apiServer:a})})).catch((function(){K.n.getSelfTest({baseURL:o}).then((function(){return a({password:"Incorrect Username/Password"})})).catch((function(){return a({password:"Offline or CORS not configured"})}))})):a({password:"Form Incomplete"})}},{key:"onLogout",value:function(){var e=this.props,t=e.cookies,n=e.serverUrl,a=this.state,r=a.apiServer,i=a.servers,o=void 0===i?[]:i,c=r.serverUrl;t.remove(Pr,Object(h.a)(Object(h.a)({},Sr),{},{path:n?"/":"".concat(Ir.replace(/\/+$/,""),"/server/").concat(encodeURIComponent(c))})),this.setState({token:void 0});var s=Object(ie.a)(o),l=s.findIndex((function(e){return e.serverUrl===c}));if(l>-1){var u=s[l];s[l]=Object(h.a)(Object(h.a)({},u),{},{hasToken:!1}),this.setState({servers:s}),this.onUpdateCookie(s)}this.onUpdateCookie(s)}},{key:"render",value:function(){var e=this.props.serverUrl,t=this.state,n=t.apiServer,a=void 0===n?{}:n,r=t.servers,i=void 0===r?[]:r,o=t.token,c=a.userName,s=a.serverUrl,l=i.map((function(e){return e.serverUrl})),u=this.props,d=u.AppComponent,m=u.AppProps,b=void 0===m?{}:m,p=u.LoginComponent,f=u.LoginProps,O=void 0===f?{}:f,x=u.AppTitleComponent,g=e?"/":"".concat(Ir.replace(/\/+$/,""),"/server/").concat(encodeURIComponent(s));return s?Object(V.jsx)(V.Fragment,{children:o?Object(V.jsx)(v.a,{basename:g,children:Object(V.jsx)(j.k,{token:o,username:c,serverUrl:s,children:Object(V.jsx)(d,Object(h.a)({onLogout:this.onLogout,AppTitleComponent:x,onLogin:this.onLogin},b))})}):Object(V.jsx)(p,Object(h.a)({AppTitleComponent:x,userName:c,serverUrl:s,onBack:e?void 0:this.onChangeServer,onLogin:this.onLogin},O))}):Object(V.jsx)(hr,{AppTitleComponent:x,onClickServer:this.onChangeServer,onAddServer:this.onAddServer,onRemoveServer:this.onRemoveServer,serverList:l})}}]),n}(r.a.Component),Dr=Object(yr.a)(kr),Rr=n(177),Er=n(262),Ar=n.n(Er),Lr=(n(293),Ar.a[500]),_r=Ar.a[300],Nr={useNextVariants:!0,htmlFontSize:18,fontFamily:'"Roboto", "Helvetica", "Arial", sans-serif',subtitle2:{fontWeight:600}},Fr={MuiButton:{root:{borderRadius:0}},MuiTableCell:{head:{fontWeight:600}},VdtQueryEntry:{queryGroup:{borderRadius:0}}},Mr={light:Object(Rr.a)({typography:Nr,overrides:Fr,palette:{type:"light",primary:{main:Lr},background:{default:"#f7f7f7"}}}),dark:Object(Rr.a)({typography:Nr,overrides:Fr,palette:{type:"dark",primary:{main:_r},background:{default:"rgb(40, 44, 52)",paper:"rgb(32, 35, 42)"}}})},Ur=n(376),Vr={en:"enUS",sv:"svSE",de:"deDE"};function qr(e){var t=e.t,n=e.lng;return Object(h.a)({VdtSort:{caption:t("sortBy")},VdtSearchInput:{searchPlaceholder:t("search")},VdtFilterCard:{headerText:t("filter")},VdtCollectionCreateDialog:{title:t("newCollection"),createText:t("create"),closeText:t("cancel"),collectionNameText:t("name")},VdtBinListMenu:{emptyBinText:t("emptyBin"),createCollectionText:t("createCollection"),allowDuplicatesText:t("allowDuplicates"),removeText:t("removeAfterDrag")},VdtBinList:{title:t("bin")},VdtItemMetadataTab:{editingLabel:function(e){return t(e?"cancel":"edit")}},VdtCollectionMetadataTab:{editingLabel:function(e){return t(e?"cancel":"edit")}},VdtJobList:{jobColumnLabels:{jobId:t("jobId"),type:t("type"),state:t("state"),user:t("createdBy"),startTime:t("started"),priority:t("priority"),status:t("status"),started:t("started"),finished:t("finished"),yesterday:t("yesterday"),thisWeek:t("thisWeek"),allTime:t("allTime")}},VdtJobTable:{jobColumnLabels:{type:t("type"),started:t("started")}},VdtJobRow:{retryText:t("retry"),deleteText:t("delete"),startedText:t("started"),finishedText:t("finished")},VdtSearchInputFieldSelect:{fieldPlaceHolder:t("field"),queryPlaceHolder:t("query")},VdtSelectedFile:{fileText:t("file")},VdtSelectedStorage:{storageText:t("storage")},VdtStorageTree:{storageText:t("storage"),loadMoreText:t("loadMore")},VdtFieldGroupDesigner:{onSavedText:t("hasBeenSaved"),selectedGroupText:t("selectedGroup"),availableFieldsText:t("availableFields"),currentFieldsText:t("currentFields"),editorText:t("editor")},VdtFieldGroupEditor:{nameText:t("name"),typeText:t("type"),deleteText:t("delete"),revertText:t("revert"),updateText:t("update"),deleteFieldText:t("deleteField"),deleteConfirmationText:t("deleteConfirmation")},VdtUserAvatarButton:{signOutText:t("signOut"),toggleThemeText:t("toggleTheme")},VdtUpload:{UploadToCollectionButtonText:t("Upload To Collection"),UploadButtonDisabledText:t("uploading"),UploadButtonText:t("upload"),DragActiveText:t("dropFilesHere"),DragInactiveText:t("dropOrClick"),UploadCollectionPickerProps:{titleText:t("Upload To Collection"),submitText:t("upload")}},VdtSourceSelection:{previewSourceText:t("previewSource")},VdtItemFieldGroupTab:{editingLabel:function(e){return t(e?"cancel":"edit")},metadataGroupText:t("metadataGroup")},VdtItemMetadataForm:{saveText:t("save")},VdtItemTimespanFilter:{searchText:t("search")},VdtItemTimespanSelection:{eventTypeText:t("eventType")},VdtConfidenceSlider:{confidenceText:t("confidence")},VdtItemTimespanEdit:{sameAsStartText:t("sameAsStart"),laterThanEndText:t("laterThanEnd")},VdtItemTimespanForm:{startText:t("start"),endText:t("end"),textText:t("text"),requiredText:t("required"),saveText:t("save"),deleteText:t("delete"),cancelText:t("cancel")},VdtUrlField:{label:t("vsApiServer")},VdtUsernameField:{label:t("username"),requiredText:t("required")},VdtPasswordField:{label:t("password"),requiredText:t("required")},VdtRememberMeField:{label:t("rememberMe")},VdtLoginFormButtons:{loginText:t("login")},VdtQueryOperator:{operatorText:t("operator"),fieldText:t("field")},VdtQueryField:{fieldText:t("field"),valueText:t("value")},VdtAddToCollectionDialog:{titleText:t("addToCollection"),submitText:t("addToCollection")},VdtCollectionSearchPicker:{idLabelText:t("id"),titleLabelText:t("title"),ownerLabelText:t("owner"),searchPlaceholder:t("searchCollections")},VdtEntityAccessEdit:{permissionText:t("permission"),recipientTypeText:t("recipientType"),grantAccessText:t("grantAccess"),userText:t("user"),groupText:t("group"),searchText:t("search")},VdtCollectionAccessTab:{toggleAddLabelText:function(e){return t(e?"cancel":"grantAccess")}},VdtItemAccessTab:{toggleAddLabelText:function(e){return t(e?"cancel":"grantAccess")}},VdtSavedSearchRow:{editTitleText:t("edit"),shareText:t("share"),listAccessText:t("access"),deleteText:t("delete")},VdtSavedSearchList:{searchPlaceholderText:t("findSearches")},VdtSaveSearchForm:{nameText:t("newSavedSearch"),saveText:t("save")},VdtCreateCollection:{collectionNameText:t("newCollection")},VdtSpellCheck:{didYouMeanText:t("didYouMean")},VdtItemMetadataFieldRow:{labelText:function(e,n){return t(e,n)}}},Ur[Vr[n]].props)}function Br(){var e=Object(s.a)().t;return document.title=k||e("appTitle"),Object(V.jsx)(c.M,{themes:Mr,props:qr({t:e,lng:H.language}),children:Object(V.jsx)(Dr,{AppComponent:tr,LoginComponent:rr,AppTitleComponent:q,serverUrl:P})})}o.a.render(Object(V.jsx)(a.Suspense,{fallback:null,children:Object(V.jsx)(Br,{})}),document.getElementById("root"))}},[[518,1,2]]]);